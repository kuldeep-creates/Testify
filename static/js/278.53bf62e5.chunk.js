"use strict";(self.webpackChunktestify=self.webpackChunktestify||[]).push([[278,884],{372:(e,s,t)=>{t.d(s,{Ml:()=>l});var a=t(9379),i=t(6667),n=t(791);async function l(e){const s=(0,i.doc)(n.db,"tests",e),t=await(0,i.getDoc)(s);if(!t.exists())return null;const l=(await(0,i.getDocs)((0,i.collection)(s,"questions"))).docs.map(e=>{const s=e.data();return(0,a.A)({id:s.questionId||e.id},s)});return(0,a.A)((0,a.A)({id:t.id},t.data()),{},{questions:l})}},1978:(e,s,t)=>{t.d(s,{Qg:()=>i,Te:()=>a,cf:()=>n,fN:()=>l});const a=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(e.includes("exported")||e.includes("submitted")||e.includes("updated"))&&alert(e),s&&setTimeout(s,100)},i=function(e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;alert(e),s&&setTimeout(s,100)},n=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;s&&setTimeout(s,100)},l=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=window.confirm(e);return a&&s?s():!a&&t&&t(),a}},2617:(e,s,t)=>{t.r(s),t.d(s,{default:()=>me});var a=t(5043),i=t(5352),n=t(980),l=t(1978),o=t(8884),c=t(9530),d=t(9379),r=t(5982),u=t(6667),m=t(2174),h=t(791);const x=e=>{if(!e)return"N/A";if(e.toDate&&"function"===typeof e.toDate)return e.toDate().toLocaleString();if(e.seconds)return new Date(1e3*e.seconds).toLocaleString();const s=new Date(e);return isNaN(s.getTime())?"N/A":s.toLocaleString()},p=e=>{if(!e)return"N/A";if(e.toDate&&"function"===typeof e.toDate)return e.toDate().toLocaleDateString();if(e.seconds)return new Date(1e3*e.seconds).toLocaleDateString();const s=new Date(e);return isNaN(s.getTime())?"N/A":s.toLocaleDateString()};var v=t(9223),g=t.n(v),b=t(5452);const j=async e=>{let{submissions:s,selectedTest:t,setLoading:a}=e,i="";try{a(!0);let e=[];try{b.A.debug("Fetching questions from subcollection");const s=await(0,u.getDocs)((0,u.collection)(h.db,"tests",t.id,"questions"));if(s.empty||(e=s.docs.map(e=>{const s=e.data();return(0,d.A)({id:s.questionId||e.id},s)}),b.A.debug("Loaded questions from subcollection",{count:e.length})),0===e.length){b.A.debug("Subcollection empty, trying embedded questions");const s=await(0,u.getDoc)((0,u.doc)(h.db,"tests",t.id));if(s.exists()){const t=s.data();e=t.questions||[],b.A.debug("Loaded embedded questions from tests doc",{count:e.length})}}if(0===e.length){b.A.debug("Trying legacy collection");const s=await(0,u.getDoc)((0,u.doc)(h.db,"test",t.id));if(s.exists()){const t=s.data();e=t.questions||[],b.A.debug("Loaded questions from legacy collection",{count:e.length})}}0===e.length&&t.questions&&(e=t.questions,b.A.debug("Loaded questions from selectedTest prop",{count:e.length}))}catch(n){b.A.error("Error fetching test questions",null,n)}b.A.debug("Excel export data structure",{submissionCount:s.length,hasFirstSubmission:!!s[0],questionCount:e.length});const o=await Promise.all(s.map(async(s,t)=>{var a,i,l;b.A.debug("Processing submission ".concat(t+1),{submissionId:s.id});let o={fullName:s.candidateName||"Unknown",gmail:"",mobile:"",year:""};if(s.candidateId)try{const e=await(0,u.getDoc)((0,u.doc)(h.db,"user",s.candidateId));if(e.exists()){const t=e.data();o={fullName:t.fullName||t.name||s.candidateName||"Unknown",gmail:t.gmail||t.email||"",mobile:t.mobile||t.phone||"",year:t.year||""}}}catch(n){b.A.error("Error fetching user data for export",{candidateId:s.candidateId},n)}const c={"Student Name":o.fullName,"Mobile Number":o.mobile,"Gmail ID":o.gmail,Year:o.year};if(b.A.debug("Processing submission answers",{submissionId:s.id||t,hasAnswers:!!s.answers,answerKeys:s.answers?Object.keys(s.answers):[]}),s.answers&&"object"===typeof s.answers){const t=Object.keys(s.answers).filter(e=>!e.includes("_notes")&&!e.includes("timestamp")&&!e.includes("metadata"));if(b.A.debug("Filtered answer keys",{keys:t}),e.length>0){const a=[...e].sort((s,t)=>{if(void 0!==s.order&&void 0!==t.order)return s.order-t.order;if(void 0!==s.index&&void 0!==t.index)return s.index-t.index;const a=parseInt(s.id),i=parseInt(t.id);return isNaN(a)||isNaN(i)?s.createdAt&&t.createdAt?s.createdAt-t.createdAt:e.indexOf(s)-e.indexOf(t):a-i});b.A.debug("Question ordering for Excel",{originalCount:e.length,sortedCount:a.length}),a.forEach((a,i)=>{const n=a.id,l=a.questionText||"Question ".concat(i+1);let o="";if(s.answers[n])o=s.answers[n];else if(s.answers[n.toString()])o=s.answers[n.toString()];else if(s.answers[i])o=s.answers[i];else if(s.answers[i.toString()])o=s.answers[i.toString()];else{const e=t.filter(e=>{const s=e.toLowerCase(),t=String(n).toLowerCase();return s==="q".concat(i+1)||s==="question".concat(i+1)||s==="question_".concat(i+1)||s.includes(t)||e===(i+1).toString()});e.length>0&&(o=s.answers[e[0]])}!o&&t.length===e.length&&i<t.length&&(o=s.answers[t[i]]);const d=l,r=o?"string"===typeof o?o:JSON.stringify(o):"-";c[d]=r,b.A.debug("Question ".concat(i+1," processed"),{hasAnswer:!!o})})}else b.A.warn("No test questions found, using neutral headers"),t.forEach((e,t)=>{const a=s.answers[e],i="Question ".concat(t+1),n=a?"string"===typeof a?a:JSON.stringify(a):"-";c[i]=n,b.A.debug("Column processed: ".concat(i),{hasAnswer:!!a})})}else e.forEach((e,s)=>{const t=e.questionText||"Question ".concat(s+1),a=t.length>50?t.substring(0,50)+"...":t;c[a]="-"});return c["Score Obtained"]=s.totalMarksAwarded||0,c.Percentage="".concat(s.score||0,"%"),c["Submitted At"]=(null===(a=s.submittedAt)||void 0===a||null===(i=a.toDate)||void 0===i||null===(l=i.call(a))||void 0===l?void 0:l.toLocaleDateString())||"N/A",b.A.debug("Row data processed",{columnCount:Object.keys(c).length}),c})),c=new(g().Workbook),r=c.addWorksheet("Test Results"),m=o.length>0?Object.keys(o[0]):[];r.addRow(m),o.forEach(e=>{const s=m.map(s=>e[s]||"");r.addRow(s)}),m.forEach((e,s)=>{const t=r.getColumn(s+1);t.width="Student Name"===e?25:"Mobile Number"===e?15:"Gmail ID"===e?30:"Year"===e?8:"Score Obtained"===e||"Total Marks"===e||"Percentage"===e?12:"Submitted At"===e?15:60});const x=r.getRow(1);x.font={bold:!0},x.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}},i="".concat(t.title.replace(/[^a-zA-Z0-9]/g,"_"),"_Results_").concat((new Date).toISOString().split("T")[0],".xlsx");const p=await c.xlsx.writeBuffer(),v=new Blob([p],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),j=window.URL.createObjectURL(v),N=document.createElement("a");N.href=j,N.download=i,N.click(),window.URL.revokeObjectURL(j),(0,l.Te)("Excel file exported successfully!")}catch(n){b.A.error("Error exporting to Excel",{fileName:i},n),(0,l.Qg)("Failed to export Excel file. Please try again.",n)}finally{a(!1)}};var N=t(1389),f=t(4857);const y=async e=>{let{submissions:s,selectedTest:t,setLoading:a,exportType:i="head"}=e,n="";try{b.A.info("Starting PDF export",{submissions:s.length,test:t.title,exportType:i}),a(!0);let e=[];b.A.debug("Starting question fetch for test",{testId:t.id});try{b.A.debug("Fetching questions from subcollection");const s=await(0,u.getDocs)((0,u.collection)(h.db,"tests",t.id,"questions"));if(s.empty||(e=s.docs.map(e=>{const s=e.data();return(0,d.A)({id:s.questionId||e.id},s)}),b.A.debug("Loaded questions from subcollection",{count:e.length})),0===e.length){const s=await(0,u.getDoc)((0,u.doc)(h.db,"tests",t.id));if(s.exists()){const t=s.data();e=t.questions||t.Questions||t.testQuestions||t.questionsList||[],0===e.length&&t.questions&&"object"===typeof t.questions&&!Array.isArray(t.questions)&&(e=Object.values(t.questions)),b.A.debug("Loaded questions from tests doc",{count:e.length})}else b.A.warn("Test document not found in tests collection")}if(0===e.length){const s=await(0,u.getDoc)((0,u.doc)(h.db,"test",t.id));if(s.exists()){const t=s.data();e=t.questions||[],b.A.debug("Loaded questions from legacy collection",{count:e.length})}}0===e.length&&t.questions&&(e=t.questions,b.A.debug("Loaded questions from selectedTest prop",{count:e.length}))}catch(o){b.A.error("Error fetching test questions",null,o)}const c=await Promise.all(s.map(async s=>{let t={fullName:s.candidateName||"Unknown",gmail:"",mobile:"",year:""};if(s.candidateId)try{const e=await(0,u.getDoc)((0,u.doc)(h.db,"user",s.candidateId));if(e.exists()){const a=e.data();t={fullName:a.fullName||a.name||s.candidateName||"Unknown",gmail:a.gmail||a.email||"",mobile:a.mobile||a.phone||"",year:a.year||""}}}catch(o){b.A.error("Error fetching user data for export",{candidateId:s.candidateId},o)}const a=[t.fullName,t.mobile,t.gmail,t.year];if(s.answers&&"object"===typeof s.answers){const t=Object.keys(s.answers).filter(e=>!e.includes("_notes")&&!e.includes("timestamp")&&!e.includes("metadata"));if(e.length>0){const i=[...e].sort((s,t)=>{if(void 0!==s.order&&void 0!==t.order)return s.order-t.order;if(void 0!==s.index&&void 0!==t.index)return s.index-t.index;const a=parseInt(s.id),i=parseInt(t.id);return isNaN(a)||isNaN(i)?s.createdAt&&t.createdAt?s.createdAt-t.createdAt:e.indexOf(s)-e.indexOf(t):a-i});b.A.debug("Question ordering",{original:e.map(e=>{var s;return{id:e.id,text:null===(s=e.questionText)||void 0===s?void 0:s.substring(0,30)}}),sorted:i.map(e=>{var s;return{id:e.id,text:null===(s=e.questionText)||void 0===s?void 0:s.substring(0,30)}})}),i.forEach((i,n)=>{const l=i.id;let o="";if(s.answers[l])o=s.answers[l];else if(s.answers[l.toString()])o=s.answers[l.toString()];else if(s.answers[n])o=s.answers[n];else if(s.answers[n.toString()])o=s.answers[n.toString()];else{const a=t.filter(e=>{const s=e.toLowerCase(),t=String(l).toLowerCase();return s==="q".concat(n+1)||s==="question".concat(n+1)||s==="question_".concat(n+1)||s.includes(t)||e===(n+1).toString()});a.length>0?o=s.answers[a[0]]:t.length===e.length&&n<t.length&&(o=s.answers[t[n]])}const c=o?"string"===typeof o?o:JSON.stringify(o):"-";a.push(c)})}else b.A.warn("No test questions found, using answer keys directly"),t.forEach(e=>{const t=s.answers[e],i=t?"string"===typeof t?t:JSON.stringify(t):"-";a.push(i)})}else if(e.length>0)e.forEach(()=>{a.push("-")});else for(let e=0;e<3;e++)a.push("-");return a.push(s.totalMarksAwarded||0,"".concat(s.score||0,"%"),s.status||"submitted"),a})),r=new N.Ay("landscape");b.A.debug("PDF document created successfully"),r.setFontSize(16);const m="admin"===i?"Admin Export - ":"";r.text("".concat(m,"Test Results: ").concat(t.title),14,22),r.setFontSize(10),r.text("Domain: ".concat(t.branch||t.domain||"N/A"),14,32),r.text("Total Marks: ".concat(t.totalMarks||100),14,38),r.text("Export Date: ".concat((new Date).toLocaleDateString()),14,44),r.text("Total Submissions: ".concat(s.length),14,50);const x=["Student Name","Mobile","Gmail ID","Year"],p=[];if(e.length>0){[...e].sort((s,t)=>{if(void 0!==s.order&&void 0!==t.order)return s.order-t.order;if(void 0!==s.index&&void 0!==t.index)return s.index-t.index;const a=parseInt(s.id),i=parseInt(t.id);return isNaN(a)||isNaN(i)?s.createdAt&&t.createdAt?s.createdAt-t.createdAt:e.indexOf(s)-e.indexOf(t):a-i}).forEach((e,s)=>{const t=e.questionText?"Q".concat(s+1,": ").concat(e.questionText):"Q".concat(s+1);p.push(t)})}else if(b.A.warn("No test questions found, using neutral headers"),s.length>0&&s[0].answers){const e=Object.keys(s[0].answers).filter(e=>!e.includes("_notes")&&!e.includes("timestamp")&&!e.includes("metadata"));for(let s=1;s<=e.length;s++)p.push("Q".concat(s))}else for(let s=1;s<=3;s++)p.push("Q".concat(s));const v=["Score","%","Status"],g=[...x,...p,...v],j="admin"===i?[59,130,246]:[147,51,234];b.A.debug("Adding table to PDF",{headerCount:g.length}),(0,f.Ay)(r,{head:[g],body:c,startY:60,styles:{fontSize:7},headStyles:{fillColor:j},columnStyles:(0,d.A)({0:{cellWidth:25},1:{cellWidth:20},2:{cellWidth:30},3:{cellWidth:12}},Object.fromEntries(p.map((e,s)=>[s+4,{cellWidth:40}]))),margin:{left:14,right:14},didParseCell:function(e){""!==e.cell.text[0]&&null!==e.cell.text[0]&&void 0!==e.cell.text[0]||(e.cell.text=["-"])}});const y="admin"===i?"Admin_":"";n="".concat(t.title.replace(/[^a-zA-Z0-9]/g,"_"),"_").concat(y,"Results_").concat((new Date).toISOString().split("T")[0],".pdf"),b.A.info("Saving PDF file",{fileName:n}),r.save(n),(0,l.Te)("PDF file exported successfully!")}catch(o){b.A.error("Error exporting to PDF",{fileName:n},o),(0,l.Qg)("Failed to export PDF file: ".concat(o.message,". Please try again."),o)}finally{a(!1)}},w=t.p+"static/media/1st-place.67172223fc5ed396e508.png",k=t.p+"static/media/2nd-place.ea97f82b687167cafff2.png",A=t.p+"static/media/3dicons-calender-dynamic-color.7d4e044581dc71a953b2.png",S=t.p+"static/media/3dicons-computer-dynamic-color.9bdf12da81911b171347.png",q=t.p+"static/media/3dicons-copy-dynamic-color.82b5fb125e2b5f1398c0.png",C=t.p+"static/media/3dicons-file-text-dynamic-color.65876296f10b19e1dfe5.png",T=t.p+"static/media/3dicons-fire-dynamic-color.5430754446ba4173e47b.png",D=t.p+"static/media/3dicons-girl-dynamic-color.c8d03a95b712659384be.png",M=t.p+"static/media/3dicons-mail-dynamic-color.e48db7bc2c5e6f2b8ed7.png",I=t.p+"static/media/3dicons-notebook-dynamic-color.115fad2789dabfbab144.png",E=t.p+"static/media/3dicons-shield-dynamic-color.270b9887b567818a5a9a.png",L=t.p+"static/media/3dicons-target-dynamic-color.bf43798cc82eb72659e6.png",F=t.p+"static/media/3dicons-thumb-up-dynamic-color.383d2372790aa1e3e4b6.png",U=t.p+"static/media/3rd-place.028d6cdb0a8cd3b970b4.png",z=t.p+"static/media/leaderboard.85239e95c5253ce686bd.png";var P=t(579);const R={document:C,paper:C,file:C,text:C,chart:S,submissions:S,analytics:S,data:S,copy:q,duplicate:q,calendar:A,schedule:A,date:A,success:F,approve:F,like:F,correct:F,shield:E,security:E,admin:E,protect:E,target:L,goal:L,performance:L,score:L,mail:M,email:M,message:M,notification:M,notebook:I,learn:I,education:I,study:I,fire:T,energy:T,active:T,hot:T,user:D,profile:D,candidate:D,person:D,first:w,"1st":w,gold:w,winner:w,"first-place":w,second:k,"2nd":k,silver:k,"second-place":k,third:U,"3rd":U,bronze:U,"third-place":U,leaderboard:z,ranking:z,standings:z,scoreboard:z},O=e=>{let{name:s,size:t="medium",className:a="",alt:i="",style:n={}}=e;const l=R[s];if(!l)return console.warn('Icon "'.concat(s,'" not found. Available icons:'),Object.keys(R)),null;const o="icon-".concat(t),c="icon ".concat(o," ").concat(a).trim();return(0,P.jsx)("img",{src:l,alt:i||"".concat(s," icon"),className:c,style:n})},B=t.p+"static/media/User Interface.3c64139db10afc313c4a.mp4",Q=()=>{var e;const[s,t]=(0,a.useState)([]),[i,l]=(0,a.useState)(null),[o,r]=(0,a.useState)([]),[m,p]=(0,a.useState)(!0),[v,g]=(0,a.useState)(!1),[j,N]=(0,a.useState)(""),[f,y]=(0,a.useState)({}),[w,k]=(0,a.useState)(!1),{userDoc:A}=(0,n.D)(),S="admin"===(null===A||void 0===A?void 0:A.role),q="head"===(null===A||void 0===A?void 0:A.role),C="candidate"===(null===A||void 0===A?void 0:A.role)||!(null!==A&&void 0!==A&&A.role),T=S||q;(0,a.useEffect)(()=>{if(!A)return;(async()=>{try{p(!0),N("");const e=(0,u.collection)(h.db,"tests"),s=(await(0,u.getDocs)(e)).docs.map(e=>(0,d.A)({id:e.id},e.data()));let a=s;"head"===(null===A||void 0===A?void 0:A.role)&&null!==A&&void 0!==A&&A.domain&&(a=s.filter(e=>e.domain===A.domain));const i={};a.forEach(e=>{!0===e.leaderboardPublished&&(i[e.id]={published:!0,testId:e.id,testTitle:e.title,publishedBy:e.publishedBy||"unknown",publishedAt:e.publishedAt||new Date,publisherRole:e.publisherRole||"unknown"})}),t(a),y(i),p(!1)}catch(e){console.error("Error loading tests and leaderboards:",e),N("Failed to load tests: ".concat(e.message||"Unknown error")),p(!1)}})()},[A]);const D=e=>{var t;const a=!0===(null===(t=f[e])||void 0===t?void 0:t.published),i=s.find(s=>s.id===e),n=!0===(null===i||void 0===i?void 0:i.leaderboardPublished);return a||n},M=()=>{if(N(""),p(!0),A){(async()=>{try{p(!0),N("");const e=(0,u.collection)(h.db,"tests"),s=(await(0,u.getDocs)(e)).docs.map(e=>(0,d.A)({id:e.id},e.data()));let a=s;"head"===(null===A||void 0===A?void 0:A.role)&&null!==A&&void 0!==A&&A.domain&&(a=s.filter(e=>e.domain===A.domain));const i={};a.forEach(e=>{!0===e.leaderboardPublished&&(i[e.id]={published:!0,testId:e.id,testTitle:e.title,publishedBy:e.publishedBy||"unknown",publishedAt:e.publishedAt||new Date,publisherRole:e.publisherRole||"unknown"})}),t(a),y(i),p(!1)}catch(e){N("Failed to load tests: ".concat(e.message||"Unknown error")),p(!1)}})()}};return m?(0,P.jsx)("div",{className:"leaderboard-container",children:(0,P.jsx)(c.A,{message:"Loading tests",subtext:"Fetching available tests for leaderboard"})}):j?(0,P.jsx)("div",{className:"leaderboard-container",children:(0,P.jsxs)("div",{className:"error-message",children:[(0,P.jsx)(O,{name:"fire",size:"large"}),(0,P.jsx)("h3",{children:"Error Loading Leaderboard"}),(0,P.jsx)("p",{children:j}),(0,P.jsxs)("button",{className:"btn btn-primary",onClick:M,style:{marginTop:"1rem"},children:[(0,P.jsx)(O,{name:"target",size:"small"}),"Try Again"]})]})}):C&&0===Object.keys(f).length?(0,P.jsx)("div",{className:"leaderboard-container",children:(0,P.jsxs)("div",{className:"video-placeholder",children:[(0,P.jsxs)("div",{className:"video-text-section",children:[(0,P.jsx)(O,{name:"leaderboard",size:"2xl"}),(0,P.jsx)("h2",{children:"Leaderboards Coming Soon!"}),(0,P.jsx)("p",{children:"Your instructors will publish test leaderboards here when they're ready."})]}),(0,P.jsx)("div",{className:"video-container",children:(0,P.jsxs)("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"interface-video",children:[(0,P.jsx)("source",{src:B,type:"video/mp4"}),"Your browser does not support the video tag."]})})]})}):(0,P.jsx)("div",{className:"leaderboard-container",children:i?(0,P.jsxs)("div",{className:"leaderboard-content",children:[(0,P.jsxs)("div",{className:"leaderboard-nav",children:[(0,P.jsxs)("button",{className:"btn btn-outline",onClick:()=>{l(null),r([])},children:[(0,P.jsx)(O,{name:"leaderboard",size:"small"}),"Back to Tests"]}),(0,P.jsxs)("div",{className:"test-info-header",children:[(0,P.jsx)("h2",{children:i.title}),(0,P.jsxs)("div",{className:"test-meta",children:[(0,P.jsxs)("span",{children:["Domain: ",i.domain]}),(0,P.jsxs)("span",{children:["Total Marks: ",i.totalMarks||"N/A"]}),(0,P.jsxs)("span",{children:["Participants: ",o.length]})]})]})]}),v?(0,P.jsx)(c.A,{message:"Loading leaderboard",subtext:"Calculating rankings and performance data"}):(0,P.jsxs)("div",{className:"leaderboard-dashboard",children:[(0,P.jsxs)("div",{className:"performance-overview",children:[(0,P.jsxs)("div",{className:"overview-stats",children:[(0,P.jsxs)("div",{className:"stat-card",children:[(0,P.jsx)(O,{name:"user",size:"xl"}),(0,P.jsxs)("div",{className:"stat-content",children:[(0,P.jsx)("h3",{children:"Total Participants"}),(0,P.jsx)("span",{className:"stat-number",children:o.length})]})]}),(0,P.jsxs)("div",{className:"stat-card",children:[(0,P.jsx)(O,{name:"success",size:"xl"}),(0,P.jsxs)("div",{className:"stat-content",children:[(0,P.jsx)("h3",{children:"Top Score"}),(0,P.jsxs)("span",{className:"stat-number",children:[o.length>0?Math.round((null===(e=o[0])||void 0===e?void 0:e.score)||0):0,"%"]})]})]})]}),(0,P.jsxs)("div",{className:"chart-section",children:[(0,P.jsx)("h3",{children:"Performance Distribution"}),(()=>{const e=(()=>{if(0===o.length)return[];const e=[{label:"Excellent (90-100%)",min:90,max:100,color:"#10b981",count:0},{label:"Good (70-89%)",min:70,max:89,color:"#3b82f6",count:0},{label:"Average (50-69%)",min:50,max:69,color:"#f59e0b",count:0},{label:"Below Average (0-49%)",min:0,max:49,color:"#ef4444",count:0}];return o.forEach(s=>{const t=s.score,a=e.find(e=>t>=e.min&&t<=e.max);a&&a.count++}),e.filter(e=>e.count>0)})();if(0===e.length)return null;const s=e.reduce((e,s)=>e+s.count,0);let t=0;return(0,P.jsxs)("div",{className:"pie-chart-container",children:[(0,P.jsxs)("div",{className:"pie-chart",children:[(0,P.jsx)("svg",{viewBox:"0 0 42 42",className:"pie-svg",children:e.map((e,a)=>{const i=e.count/s*100,n="".concat(i," ").concat(100-i),l=-t;return t+=i,(0,P.jsx)("circle",{className:"pie-segment",cx:"21",cy:"21",r:"15.915",fill:"transparent",stroke:e.color,strokeWidth:"3",strokeDasharray:n,strokeDashoffset:l,transform:"rotate(-90 21 21)"},a)})}),(0,P.jsxs)("div",{className:"pie-center",children:[(0,P.jsx)("span",{className:"pie-total",children:s}),(0,P.jsx)("span",{className:"pie-label",children:"Total"})]})]}),(0,P.jsx)("div",{className:"pie-legend",children:e.map((e,t)=>(0,P.jsxs)("div",{className:"legend-item",children:[(0,P.jsx)("div",{className:"legend-color",style:{backgroundColor:e.color}}),(0,P.jsxs)("span",{className:"legend-text",children:[e.label,": ",e.count," (",Math.round(e.count/s*100),"%)"]})]},t))})]})})()]})]}),(0,P.jsxs)("div",{className:"leaderboard-table-section",children:[(0,P.jsx)("h3",{children:"Rankings"}),(0,P.jsx)("div",{className:"table-container",children:(0,P.jsxs)("table",{className:"leaderboard-table",children:[(0,P.jsx)("thead",{children:(0,P.jsxs)("tr",{children:[(0,P.jsx)("th",{children:"Rank"}),(0,P.jsx)("th",{children:"Candidate Name"}),(0,P.jsx)("th",{children:"Score"}),(0,P.jsx)("th",{children:"Marks"}),(0,P.jsx)("th",{children:"Submitted At"})]})}),(0,P.jsx)("tbody",{children:o.map(e=>{return(0,P.jsxs)("tr",{className:"rank-".concat(e.rank),children:[(0,P.jsx)("td",{children:(0,P.jsxs)("div",{className:"rank-badge ".concat((s=e.rank,1===s?"gold":2===s?"silver":3===s?"bronze":"default")),children:[1===e.rank&&(0,P.jsx)(O,{name:"gold",size:"small"}),2===e.rank&&(0,P.jsx)(O,{name:"silver",size:"small"}),3===e.rank&&(0,P.jsx)(O,{name:"bronze",size:"small"}),"#",e.rank]})}),(0,P.jsx)("td",{children:(0,P.jsxs)("div",{className:"candidate-info",children:[(0,P.jsx)(O,{name:"user",size:"small"}),(0,P.jsx)("span",{children:e.candidateName})]})}),(0,P.jsx)("td",{children:(0,P.jsx)("div",{className:"score-display",children:(0,P.jsxs)("span",{className:"score-percentage ".concat(e.score>=90?"excellent":e.score>=70?"good":e.score>=50?"average":"below-average"),children:[Math.round(e.score),"%"]})})}),(0,P.jsx)("td",{children:(0,P.jsxs)("span",{className:"marks-fraction",children:[e.totalMarksAwarded,"/",e.maxPossibleMarks]})}),(0,P.jsx)("td",{children:(0,P.jsx)("span",{className:"submission-date",children:x(e.submittedAt)})})]},e.id);var s})})]})}),0===o.length&&(0,P.jsxs)("div",{className:"no-submissions",children:[(0,P.jsx)(O,{name:"notebook",size:"2xl"}),(0,P.jsx)("h3",{children:"No Evaluated Submissions"}),(0,P.jsx)("p",{children:"No evaluated submissions found for this test"})]})]})]})]}):(0,P.jsxs)("div",{className:"test-selection",children:[(0,P.jsx)("div",{className:"tests-grid",children:s.map(e=>{const s=D(e.id),t=T||s;return(0,P.jsxs)("div",{className:"test-card ".concat(t?"":"test-card-disabled"),onClick:()=>t&&(async e=>{try{g(!0),l(e),N(""),r([]);const s=(0,u.query)((0,u.collection)(h.db,"results"),(0,u.where)("testId","==",e.id),(0,u.where)("status","==","evaluated")),t=await(0,u.getDocs)(s);b.A.debug("Loading leaderboard data",{testTitle:e.title,submissionCount:t.docs.length});const a=await Promise.all(t.docs.map(async s=>{const t=s.data();let a=t.candidateName||"Unknown";if(t.candidateId)try{let e=null;try{const s=(0,u.query)((0,u.collection)(h.db,"user"),(0,u.where)("uid","==",t.candidateId)),a=await(0,u.getDocs)(s);a.empty||(e=a.docs[0].data())}catch(c){b.A.debug("Query by uid failed, trying direct document access")}if(!e)try{const a=s(h.db,"user",t.candidateId),i=await(0,u.getDoc)(a);i.exists()&&(e=i.data())}catch(d){b.A.debug("Direct document access failed")}e&&(a=e.name||e.displayName||e.fullName||e.firstName||a)}catch(j){b.A.debug("Could not fetch user data for candidate",{candidateId:t.candidateId},j)}let i=t.maxPossibleMarks||e.totalMarks||100,n=t.totalMarksAwarded||0;if(t.questionMarks&&"object"===typeof t.questionMarks){const e=Object.values(t.questionMarks);if(e.length>0){const s=e.reduce((e,s)=>e+(parseFloat(s)||0),0);b.A.debug("Recalculating marks from questions",{calculatedTotal:s,originalTotal:n}),n=s}}e.totalMarks&&e.totalMarks>0&&(i=e.totalMarks),n>i&&(b.A.warn("Invalid marks detected, capping to maximum",{candidateName:a,totalMarksAwarded:n,maxPossibleMarks:i}),n=i),n=Math.max(0,n),i=Math.max(1,i);const l=Math.round(n/i*100),o={id:s.id,candidateName:a,candidateId:t.candidateId,totalMarksAwarded:Math.max(0,n),maxPossibleMarks:Math.max(1,i),score:Math.max(0,Math.min(100,l)),submittedAt:t.submittedAt,timeTaken:t.timeTaken||0,questionMarks:t.questionMarks||{}};return console.log("Final processed data:",{candidateName:o.candidateName,marks:"".concat(o.totalMarksAwarded,"/").concat(o.maxPossibleMarks),score:"".concat(o.score,"%")}),o})),i=a.sort((e,s)=>s.totalMarksAwarded!==e.totalMarksAwarded?s.totalMarksAwarded-e.totalMarksAwarded:e.timeTaken-s.timeTaken).map((e,s)=>(0,d.A)((0,d.A)({},e),{},{rank:s+1}));r(i),g(!1)}catch(s){b.A.error("Error loading leaderboard data",null,s),N("Failed to load leaderboard data: ".concat(s.message||"Unknown error")),g(!1)}})(e),children:[(0,P.jsxs)("div",{className:"test-card-header",children:[(0,P.jsx)(O,{name:"notebook",size:"medium"}),(0,P.jsx)("h3",{children:e.title}),T&&(0,P.jsx)("div",{className:"publication-controls",children:(0,P.jsx)("button",{className:"btn btn-sm ".concat(s?"btn-danger":"btn-success"),onClick:async t=>{t.stopPropagation(),console.log("Publication button clicked:",{testId:e.id,testTitle:e.title,currentStatus:s,userRole:null===A||void 0===A?void 0:A.role,canPublish:T});try{await(async(e,s)=>{if(console.log("Toggle publication called:",{testId:e,testTitle:s,canPublish:T,userRole:null===A||void 0===A?void 0:A.role,isHead:q,isAdmin:S}),T)try{var t;k(!0),N("");const a=!(null===(t=f[e])||void 0===t?void 0:t.published),i=(0,u.doc)(h.db,"tests",e);a?await(0,u.updateDoc)(i,{leaderboardPublished:!0,publishedBy:(null===A||void 0===A?void 0:A.uid)||"unknown",publishedAt:new Date,publisherRole:(null===A||void 0===A?void 0:A.role)||"unknown"}):await(0,u.updateDoc)(i,{leaderboardPublished:!1,unpublishedBy:(null===A||void 0===A?void 0:A.uid)||"unknown",unpublishedAt:new Date}),y(a?t=>(0,d.A)((0,d.A)({},t),{},{[e]:{published:!0,testId:e,testTitle:s,publishedBy:(null===A||void 0===A?void 0:A.uid)||"unknown",publishedAt:new Date,publisherRole:(null===A||void 0===A?void 0:A.role)||"unknown"}}):s=>{const t=(0,d.A)({},s);return delete t[e],t}),k(!1)}catch(j){var a;const t=null===(a=f[e])||void 0===a?void 0:a.published;N("Failed to ".concat(t?"unpublish":"publish"," leaderboard: ").concat(j.message)),k(!1)}})(e.id,e.title)}catch(j){}},disabled:w,title:s?"Unpublish Leaderboard":"Publish Leaderboard",children:w?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(O,{name:"fire",size:"small"})," Processing..."]}):s?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(O,{name:"fire",size:"small"})," Unpublish"]}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(O,{name:"success",size:"small"})," Publish"]})})})]}),(0,P.jsxs)("div",{className:"test-card-body",children:[(0,P.jsxs)("div",{className:"test-info",children:[(0,P.jsxs)("span",{className:"test-domain",children:[(0,P.jsx)(O,{name:"shield",size:"small"}),e.domain]}),(0,P.jsxs)("span",{className:"test-duration",children:[(0,P.jsx)(O,{name:"calendar",size:"small"}),e.duration||"60 min"]}),!t&&(0,P.jsxs)("span",{className:"publication-status unpublished",children:[(0,P.jsx)(O,{name:"fire",size:"small"}),"Not Published"]}),s&&(0,P.jsxs)("span",{className:"publication-status published",children:[(0,P.jsx)(O,{name:"success",size:"small"}),"Published"]})]}),(0,P.jsxs)("div",{className:"test-stats",children:[(0,P.jsxs)("span",{children:["Total Marks: ",e.totalMarks||"N/A"]}),(0,P.jsxs)("span",{children:["Status: ",e.status||"inactive"]})]})]})]},e.id)})}),0===s.length&&(0,P.jsxs)("div",{className:"video-placeholder",children:[(0,P.jsxs)("div",{className:"video-text-section",children:[(0,P.jsx)(O,{name:"notebook",size:"2xl"}),(0,P.jsx)("h2",{children:"No Tests Available"}),(0,P.jsx)("p",{children:"No tests found for leaderboard display. Tests will appear here once they are created."})]}),(0,P.jsx)("div",{className:"video-container",children:(0,P.jsxs)("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"interface-video",children:[(0,P.jsx)("source",{src:B,type:"video/mp4"}),"Your browser does not support the video tag."]})})]}),C&&s.length>0&&s.every(e=>!D(e.id))&&(0,P.jsxs)("div",{className:"no-published-leaderboards",children:[(0,P.jsx)(O,{name:"leaderboard",size:"2xl"}),(0,P.jsx)("h3",{children:"No Published Leaderboards"}),(0,P.jsx)("p",{children:"Your instructors haven't published any leaderboards yet. Check back later!"})]})]})})};function H(){const[e,s]=(0,a.useState)([]),[t,i]=(0,a.useState)({activeTests:0,completedTests:0}),[n,l]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{const e=[],t=(0,u.query)((0,u.collection)(h.db,"tests")),a=(0,u.onSnapshot)(t,async e=>{const t=await Promise.all(e.docs.map(async e=>{const s=(0,d.A)({id:e.id},e.data()),t=(0,u.query)((0,u.collection)(h.db,"results"),(0,u.where)("testId","==",e.id),(0,u.where)("status","in",["in_progress","active"])),a=await(0,u.getDocs)(t),i=(0,u.query)((0,u.collection)(h.db,"results"),(0,u.where)("testId","==",e.id)),n=await(0,u.getDocs)(i);return(0,d.A)((0,d.A)({},s),{},{liveParticipantCount:a.size,totalSubmissions:n.size})}));s(t);const a=t.filter(e=>"active"===e.status).length;i(e=>(0,d.A)((0,d.A)({},e),{},{activeTests:a}))});return e.push(a),l(!1),()=>e.forEach(e=>e())},[]),n?(0,P.jsx)("div",{className:"loading-tests",children:(0,P.jsx)(c.A,{message:"Loading overview",subtext:"Gathering system statistics and data",variant:"inline",size:"large"})}):(0,P.jsxs)("div",{className:"admin-overview",children:[(0,P.jsxs)("div",{className:"overview-header",children:[(0,P.jsx)("h2",{children:"System Overview"}),(0,P.jsx)("p",{children:"Real-time snapshot of your testing platform"})]}),(0,P.jsx)("div",{className:"overview-stats",children:(0,P.jsxs)("div",{className:"stat-card",children:[(0,P.jsx)("div",{className:"stat-icon",children:(0,P.jsx)(O,{name:"leaderboard",size:"xl"})}),(0,P.jsxs)("div",{className:"stat-content",children:[(0,P.jsx)("h3",{children:"Active Tests"}),(0,P.jsx)("p",{className:"stat-number",children:t.activeTests})]})]})}),(0,P.jsxs)("div",{className:"active-tests-section",children:[(0,P.jsx)("h3",{children:"All Tests Overview"}),0===e.length?(0,P.jsxs)("div",{className:"no-active-tests",children:[(0,P.jsx)("div",{className:"no-tests-icon",children:"\ud83d\udcda"}),(0,P.jsx)("p",{children:"No tests available at the moment"})]}):(0,P.jsx)("div",{className:"active-tests-grid",children:e.map(e=>(0,P.jsxs)("div",{className:"active-test-card ".concat("active"===e.status?"test-active":"test-inactive"),children:[(0,P.jsxs)("div",{className:"test-header",children:[(0,P.jsx)("h4",{children:e.title}),(0,P.jsx)("span",{className:"badge ".concat("active"===e.status?"badge-success":"badge-neutral"),children:"active"===e.status?"Active":"Inactive"})]}),(0,P.jsx)("div",{className:"test-details",children:(0,P.jsxs)("div",{className:"test-meta",children:[(0,P.jsxs)("div",{className:"meta-row",children:[(0,P.jsxs)("span",{className:"meta-item",children:[(0,P.jsx)("span",{className:"meta-icon",children:"\ud83c\udfaf"}),(0,P.jsx)("span",{className:"meta-label",children:"Branch:"}),(0,P.jsx)("span",{className:"meta-value",children:e.branch||"General"})]}),(0,P.jsxs)("span",{className:"meta-item",children:[(0,P.jsx)("span",{className:"meta-icon",children:"\u23f1\ufe0f"}),(0,P.jsx)("span",{className:"meta-label",children:"Duration:"}),(0,P.jsx)("span",{className:"meta-value",children:e.duration||"60 mins"})]})]}),(0,P.jsxs)("div",{className:"meta-row",children:[(0,P.jsxs)("span",{className:"meta-item",children:[(0,P.jsx)("span",{className:"meta-icon",children:"\ud83d\udcc5"}),(0,P.jsx)("span",{className:"meta-label",children:"Starts:"}),(0,P.jsx)("span",{className:"meta-value",children:x(e.startTime||e.createdAt)})]}),(0,P.jsxs)("span",{className:"meta-item",children:[(0,P.jsx)("span",{className:"meta-icon",children:"\ud83d\udcca"}),(0,P.jsx)("span",{className:"meta-label",children:"Submissions:"}),(0,P.jsx)("span",{className:"meta-value",children:e.totalSubmissions||0})]})]})]})})]},e.id))})]})]})}function _(){var e,s;const[t,i]=(0,a.useState)([]),[l,o]=(0,a.useState)(!0),[r,x]=(0,a.useState)(""),[p,v]=(0,a.useState)(""),[g,b]=(0,a.useState)("all"),[j,N]=(0,a.useState)("all"),[f,y]=(0,a.useState)(1),{user:w}=(0,n.D)(),[k,A]=(0,a.useState)(null),[S,q]=(0,a.useState)(!1),[C,T]=(0,a.useState)({submissions:[],pasteLogs:[],tabSwitchLogs:[]}),D=(null===w||void 0===w||null===(e=w.email)||void 0===e?void 0:e.toLowerCase())===m.UO.superAdminEmail.toLowerCase()||"admin"===(null===w||void 0===w?void 0:w.role);(0,a.useEffect)(()=>{(async()=>{try{const e=(0,u.collection)(h.db,"user"),s=(0,u.query)(e),t=await(0,u.getDocs)(s),a=[];t.forEach(e=>{const s=(0,d.A)({id:e.id},e.data());s.email!==m.UO.superAdminEmail&&a.push(s)}),i(a),o(!1),console.log("Users loaded successfully:",a.length)}catch(e){console.error("Error loading users:",e),x("Failed to load users: ".concat(e.message)),o(!1)}})();const e=(0,u.collection)(h.db,"user"),s=(0,u.onSnapshot)(e,e=>{const s=[];e.forEach(e=>{const t=(0,d.A)({id:e.id},e.data());t.email!==m.UO.superAdminEmail&&s.push(t)}),i(s)});return()=>s()},[]);const M=async function(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(D)try{const a=(0,u.doc)(h.db,"user",e),i={role:s,updatedAt:(0,u.serverTimestamp)()};"head"===s&&t?i.domain=t:"head"!==s&&(i.domain=null),await(0,u.updateDoc)(a,i)}catch(a){console.error("Error updating user role:",a),x("Failed to update user role: "+a.message)}else alert("You do not have permission to change user roles")},I=async e=>{A(e),q(!0);try{const t=(0,u.query)((0,u.collection)(h.db,"results"),(0,u.where)("candidateId","==",e.id));let a=(await(0,u.getDocs)(t)).docs.map(e=>(0,d.A)({id:e.id},e.data()));a.sort((e,s)=>{var t,a,i,n,l,o,c,d;const r=((null===(t=e.submittedAt)||void 0===t||null===(a=t.toDate)||void 0===a?void 0:a.call(t))||(null===(i=e.createdAt)||void 0===i||null===(n=i.toDate)||void 0===n?void 0:n.call(i))||new Date(0)).getTime();return((null===(l=s.submittedAt)||void 0===l||null===(o=l.toDate)||void 0===o?void 0:o.call(l))||(null===(c=s.createdAt)||void 0===c||null===(d=c.toDate)||void 0===d?void 0:d.call(c))||new Date(0)).getTime()-r});const i=Array.from(new Set(a.map(e=>e.testId).filter(Boolean))),n={};for(const e of i)try{const s=await(0,u.getDoc)((0,u.doc)(h.db,"tests",e));s.exists()&&(n[e]=s.data().title||e)}catch(s){}a=a.map(e=>(0,d.A)((0,d.A)({},e),{},{_testTitle:n[e.testId]||e.testId}));const l=(0,u.query)((0,u.collection)(h.db,"pasteLogs"),(0,u.where)("candidateId","==",e.id)),o=(await(0,u.getDocs)(l)).docs.map(e=>(0,d.A)({id:e.id},e.data())),c=(0,u.query)((0,u.collection)(h.db,"tabSwitchLogs"),(0,u.where)("candidateId","==",e.id)),r=(await(0,u.getDocs)(c)).docs.map(e=>(0,d.A)({id:e.id},e.data()));let m=0;if(a.length>0){const e=a.reduce((e,s)=>{const t=Number(s.totalMarksAwarded||0),a=Number(s.maxPossibleMarks||0)||100;return e+Math.max(0,Math.min(100,t/a*100))},0);m=Math.round(e/a.length*100)/100}T({submissions:a,pasteLogs:o,tabSwitchLogs:r,avgScore:m,totalTestsGiven:a.length})}catch(t){console.error("Error loading user details:",t)}finally{q(!1)}},E=()=>{A(null),T({submissions:[],pasteLogs:[],tabSwitchLogs:[]})};(0,a.useEffect)(()=>{if(!k)return;const e=e=>{"Escape"===e.key&&E()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[k]);const L=t.filter(e=>{var s,t;const a=(null===(s=e.email)||void 0===s?void 0:s.toLowerCase().includes(p.toLowerCase()))||(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(p.toLowerCase())),i="all"===g||e.role===g,n="all"===j||"active"===j&&!e.blocked||"blocked"===j&&e.blocked;return a&&i&&n}),F=Math.ceil(L.length/10),U=10*(f-1),z=L.slice(U,U+10);return(0,a.useEffect)(()=>{y(1)},[p,g,j]),l?(0,P.jsx)("div",{className:"loading-tests",children:(0,P.jsx)(c.A,{message:"Loading users",subtext:"Fetching user accounts and permissions",variant:"inline",size:"large"})}):r?(0,P.jsxs)("div",{className:"admin-users",children:[(0,P.jsxs)("div",{className:"users-header",children:[(0,P.jsx)("h2",{children:"User Management"}),(0,P.jsx)("p",{children:"Manage user roles, domains, and access permissions"})]}),(0,P.jsx)("div",{className:"error-container",children:(0,P.jsxs)("div",{className:"error",children:[(0,P.jsx)("h3",{children:"\u26a0\ufe0f Error Loading Users"}),(0,P.jsx)("p",{children:r}),(0,P.jsxs)("div",{className:"error-help",children:[(0,P.jsx)("h4",{children:"Possible Solutions:"}),(0,P.jsxs)("ul",{children:[(0,P.jsx)("li",{children:"Check your Firebase connection"}),(0,P.jsx)("li",{children:"Verify Firestore security rules allow reading the 'users' collection"}),(0,P.jsx)("li",{children:"The 'users' collection might not exist yet - it will be created when the first user signs up"}),(0,P.jsx)("li",{children:"Check the browser console for more detailed error information"})]})]})]})})]}):(0,P.jsxs)("div",{className:"admin-users",children:[(0,P.jsxs)("div",{className:"users-header",children:[(0,P.jsx)("h2",{children:"User Management"}),(0,P.jsx)("p",{children:"Manage user roles, domains, and access permissions"})]}),(0,P.jsxs)("div",{className:"users-controls",children:[(0,P.jsx)("div",{className:"search-container",children:(0,P.jsx)("input",{type:"text",placeholder:"Search by name or email...",value:p,onChange:e=>v(e.target.value),className:"search-input"})}),(0,P.jsxs)("div",{className:"filters",children:[(0,P.jsxs)("select",{value:g,onChange:e=>b(e.target.value),className:"filter-select",children:[(0,P.jsx)("option",{value:"all",children:"All Roles"}),(0,P.jsx)("option",{value:"candidate",children:"Candidates"}),(0,P.jsx)("option",{value:"head",children:"Heads"}),(0,P.jsx)("option",{value:"admin",children:"Admins"})]}),(0,P.jsxs)("select",{value:j,onChange:e=>N(e.target.value),className:"filter-select",children:[(0,P.jsx)("option",{value:"all",children:"All Status"}),(0,P.jsx)("option",{value:"active",children:"Active"}),(0,P.jsx)("option",{value:"blocked",children:"Blocked"})]})]})]}),0===t.length?(0,P.jsxs)("div",{className:"no-users",children:[(0,P.jsx)("div",{className:"no-users-icon",children:"\ud83d\udc65"}),(0,P.jsx)("h3",{children:"No Users Found"}),(0,P.jsx)("p",{children:"The users collection is empty or doesn't exist yet."}),(0,P.jsxs)("div",{className:"no-users-help",children:[(0,P.jsx)("p",{children:(0,P.jsx)("strong",{children:"This is normal if:"})}),(0,P.jsxs)("ul",{children:[(0,P.jsx)("li",{children:"This is a new installation"}),(0,P.jsx)("li",{children:"No users have signed up yet"}),(0,P.jsx)("li",{children:"Users are stored in Firebase Auth but not in Firestore"})]}),(0,P.jsx)("p",{children:"Users will appear here once they sign up and their data is stored in Firestore."})]})]}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{className:"users-table-container",children:(0,P.jsxs)("table",{className:"users-table",children:[(0,P.jsx)("thead",{children:(0,P.jsxs)("tr",{children:[(0,P.jsx)("th",{children:"Name"}),(0,P.jsx)("th",{children:"Email"}),(0,P.jsx)("th",{children:"Role"}),(0,P.jsx)("th",{children:"Domain"}),(0,P.jsx)("th",{children:"Status"}),(0,P.jsx)("th",{children:"Actions"})]})}),(0,P.jsx)("tbody",{children:z.map(e=>{var s;return(0,P.jsxs)("tr",{onDoubleClick:()=>I(e),title:"Double-click to view details",children:[(0,P.jsx)("td",{children:(0,P.jsx)("div",{className:"user-info",children:(0,P.jsx)("span",{className:"user-name user-link",onClick:()=>I(e),title:"View user details",role:"button",tabIndex:0,onKeyDown:s=>{"Enter"===s.key&&I(e)},children:e.name||"N/A"})})}),(0,P.jsx)("td",{children:(null===(s=e.email)||void 0===s?void 0:s.toLowerCase())===m.UO.superAdminEmail.toLowerCase()?"Hidden":(0,P.jsx)("span",{className:"user-link",onClick:()=>I(e),role:"button",tabIndex:0,title:"View user details",onKeyDown:s=>{"Enter"===s.key&&I(e)},children:e.email})}),(0,P.jsx)("td",{children:(0,P.jsx)(G,{user:e,onRoleChange:M,canEdit:D})}),(0,P.jsx)("td",{children:(0,P.jsx)(W,{user:e,onRoleChange:M,canEdit:D})}),(0,P.jsx)("td",{children:(0,P.jsx)("span",{className:"badge ".concat(e.blocked?"badge-error":"badge-success"),children:e.blocked?"Blocked":"Active"})}),(0,P.jsx)("td",{children:(0,P.jsx)("div",{className:"user-actions",children:(0,P.jsx)("button",{className:"btn btn-sm ".concat(e.blocked?"btn-success":"btn-danger"),onClick:()=>(async(e,s)=>{if(D)try{const t=(0,u.doc)(h.db,"user",e);await(0,u.updateDoc)(t,{blocked:!s,updatedAt:(0,u.serverTimestamp)()})}catch(t){console.error("Error updating user status:",t),x("Failed to update user status: "+t.message)}else alert("You do not have permission to block/unblock users")})(e.id,e.blocked),disabled:!D,title:e.blocked?"Unblock user":"Block user",children:e.blocked?"\ud83d\udd13":"\ud83d\udd12"})})})]},e.id)})})]})}),F>1&&(0,P.jsxs)("div",{className:"pagination",children:[(0,P.jsx)("button",{className:"btn btn-outline",disabled:1===f,onClick:()=>y(f-1),children:"Previous"}),(0,P.jsxs)("span",{className:"page-info",children:["Page ",f," of ",F," (",L.length," users)"]}),(0,P.jsx)("button",{className:"btn btn-outline",disabled:f===F,onClick:()=>y(f+1),children:"Next"})]})]}),k&&(0,P.jsx)("div",{className:"user-details-overlay",role:"dialog","aria-modal":"true",onClick:e=>{e.target===e.currentTarget&&E()},children:(0,P.jsxs)("div",{className:"user-details-panel",children:[(0,P.jsxs)("div",{className:"user-details-header",children:[(0,P.jsx)("h3",{children:"User Details"}),(0,P.jsx)("button",{className:"btn btn-sm btn-outline",onClick:E,"aria-label":"Close",children:"\u2715"})]}),(0,P.jsxs)("div",{className:"user-details-body",children:[(0,P.jsxs)("div",{className:"user-summary",children:[(0,P.jsxs)("p",{children:[(0,P.jsx)("strong",{children:"Name:"})," ",k.name||"N/A"]}),(0,P.jsxs)("p",{children:[(0,P.jsx)("strong",{children:"Email:"})," ",k.email||"N/A"]}),(0,P.jsxs)("p",{children:[(0,P.jsx)("strong",{children:"Role:"})," ",k.role||"candidate"]}),(0,P.jsxs)("p",{children:[(0,P.jsx)("strong",{children:"Domain:"})," ",k.domain||"-"]}),(0,P.jsxs)("p",{children:[(0,P.jsx)("strong",{children:"Mobile No:"})," ",k.mobile||k.phone||"-"]}),(0,P.jsxs)("p",{children:[(0,P.jsx)("strong",{children:"Total Tests Given:"})," ",null!==(s=C.totalTestsGiven)&&void 0!==s?s:C.submissions.length]}),(0,P.jsxs)("p",{children:[(0,P.jsx)("strong",{children:"Average Marks:"})," ",null!=C.avgScore?"".concat(C.avgScore,"%"):"-"]}),(0,P.jsxs)("p",{children:[(0,P.jsx)("strong",{children:"Status:"})," ",k.blocked?"Blocked":"Active"]})]}),S?(0,P.jsx)("div",{className:"loading-tests",children:(0,P.jsx)(c.A,{message:"Loading user details",subtext:"Fetching submissions and activity",variant:"inline",size:"large"})}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)("div",{className:"user-stats",children:[(0,P.jsx)("div",{className:"stat-card",children:(0,P.jsxs)("div",{className:"stat-content",children:[(0,P.jsx)("h4",{children:"Total Submissions"}),(0,P.jsx)("p",{className:"stat-number",children:C.submissions.length})]})}),(0,P.jsx)("div",{className:"stat-card",children:(0,P.jsxs)("div",{className:"stat-content",children:[(0,P.jsx)("h4",{children:"Paste Logs"}),(0,P.jsx)("p",{className:"stat-number",children:C.pasteLogs.length})]})}),(0,P.jsx)("div",{className:"stat-card",children:(0,P.jsxs)("div",{className:"stat-content",children:[(0,P.jsx)("h4",{children:"Tab Switch Logs"}),(0,P.jsx)("p",{className:"stat-number",children:C.tabSwitchLogs.length})]})})]}),(0,P.jsxs)("div",{className:"user-section",children:[(0,P.jsx)("h4",{children:"Recent Submissions"}),0===C.submissions.length?(0,P.jsx)("p",{className:"text-muted",children:"No submissions yet."}):(0,P.jsxs)("table",{className:"users-table",children:[(0,P.jsx)("thead",{children:(0,P.jsxs)("tr",{children:[(0,P.jsx)("th",{children:"Test"}),(0,P.jsx)("th",{children:"Status"}),(0,P.jsx)("th",{children:"Submitted At"})]})}),(0,P.jsx)("tbody",{children:C.submissions.slice(0,5).map(e=>{var s,t,a,i,n,l;return(0,P.jsxs)("tr",{children:[(0,P.jsx)("td",{children:e._testTitle||e.testId||"-"}),(0,P.jsx)("td",{children:e.status||"-"}),(0,P.jsx)("td",{children:(null===(s=(null===(a=e.submittedAt)||void 0===a||null===(i=a.toDate)||void 0===i?void 0:i.call(a))||(null===(n=e.createdAt)||void 0===n||null===(l=n.toDate)||void 0===l?void 0:l.call(n))||null)||void 0===s||null===(t=s.toLocaleString)||void 0===t?void 0:t.call(s))||"-"})]},e.id)})})]})]}),(0,P.jsxs)("div",{className:"user-section",children:[(0,P.jsx)("h4",{children:"Activity"}),(0,P.jsxs)("div",{className:"activity-grid",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("h5",{children:"Paste Logs"}),0===C.pasteLogs.length?(0,P.jsx)("p",{className:"text-muted",children:"No paste activity."}):(0,P.jsx)("ul",{className:"simple-list",children:C.pasteLogs.slice(0,5).map(e=>{var s,t,a,i;return(0,P.jsxs)("li",{children:[(0,P.jsxs)("span",{children:["Test: ",e.testId||"-"]}),(0,P.jsxs)("span",{style:{marginLeft:8},children:["Q: ",e.questionId||"-"]}),(0,P.jsx)("span",{style:{marginLeft:8},children:(null===(s=(null===(a=e.timestamp)||void 0===a||null===(i=a.toDate)||void 0===i?void 0:i.call(a))||null)||void 0===s||null===(t=s.toLocaleString)||void 0===t?void 0:t.call(s))||"-"})]},e.id)})})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("h5",{children:"Tab Switch Logs"}),0===C.tabSwitchLogs.length?(0,P.jsx)("p",{className:"text-muted",children:"No tab switching recorded."}):(0,P.jsx)("ul",{className:"simple-list",children:C.tabSwitchLogs.slice(0,5).map(e=>{var s,t,a,i;return(0,P.jsxs)("li",{children:[(0,P.jsxs)("span",{children:["Test: ",e.testId||"-"]}),(0,P.jsxs)("span",{style:{marginLeft:8},children:["Count: ",e.switchCount||0]}),(0,P.jsx)("span",{style:{marginLeft:8},children:(null===(s=(null===(a=e.lastUpdated)||void 0===a||null===(i=a.toDate)||void 0===i?void 0:i.call(a))||null)||void 0===s||null===(t=s.toLocaleString)||void 0===t?void 0:t.call(s))||"-"})]},e.id)})})]})]})]})]})]})]})}),!D&&(0,P.jsxs)("div",{className:"permission-notice",children:[(0,P.jsx)("span",{className:"notice-icon",children:"\u26a0\ufe0f"}),(0,P.jsx)("span",{children:"You have read-only access. Contact the super admin for admin permissions."})]})]})}function G(e){let{user:s,onRoleChange:t,canEdit:i}=e;const[n,l]=(0,a.useState)(!1),[o,c]=(0,a.useState)(s.role||"candidate"),d=()=>{o!==s.role&&t(s.id,o),l(!1)};return i?n?(0,P.jsxs)("div",{className:"role-editor",children:[(0,P.jsxs)("select",{value:o,onChange:e=>c(e.target.value),className:"role-select",children:[(0,P.jsx)("option",{value:"candidate",children:"Candidate"}),(0,P.jsx)("option",{value:"head",children:"Head"}),(0,P.jsx)("option",{value:"admin",children:"Admin"})]}),(0,P.jsxs)("div",{className:"role-actions",children:[(0,P.jsx)("button",{className:"btn btn-sm btn-primary",onClick:d,children:(0,P.jsx)(O,{name:"success",size:"small"})}),(0,P.jsx)("button",{className:"btn btn-sm btn-outline",onClick:()=>l(!1),children:(0,P.jsx)(O,{name:"fire",size:"small"})})]})]}):(0,P.jsxs)("div",{className:"role-display",onClick:()=>l(!0),children:[(0,P.jsx)("span",{className:"badge badge-".concat(s.role||"candidate"),children:(s.role||"candidate").charAt(0).toUpperCase()+(s.role||"candidate").slice(1)}),(0,P.jsx)("span",{className:"edit-hint",children:"Click to edit"})]}):(0,P.jsx)("span",{className:"badge badge-".concat(s.role||"candidate"),children:(s.role||"candidate").charAt(0).toUpperCase()+(s.role||"candidate").slice(1)})}function W(e){let{user:s,onRoleChange:t,canEdit:i}=e;const[n,l]=(0,a.useState)(!1),[o,c]=(0,a.useState)(s.domain||""),d=["DSA","Fullstack","Java","Data Science"],r=()=>{"head"===s.role&&t(s.id,"head",o),l(!1)};return"head"!==s.role?(0,P.jsx)("span",{className:"text-muted",children:"-"}):i?n?(0,P.jsxs)("div",{className:"domain-editor",children:[(0,P.jsxs)("select",{value:o,onChange:e=>c(e.target.value),className:"domain-select",children:[(0,P.jsx)("option",{value:"",children:"Select Domain"}),d.map(e=>(0,P.jsx)("option",{value:e,children:e},e))]}),(0,P.jsxs)("div",{className:"domain-actions",children:[(0,P.jsx)("button",{className:"btn btn-sm btn-primary",onClick:r,children:(0,P.jsx)(O,{name:"success",size:"small"})}),(0,P.jsx)("button",{className:"btn btn-sm btn-outline",onClick:()=>l(!1),children:(0,P.jsx)(O,{name:"fire",size:"small"})})]})]}):(0,P.jsxs)("div",{className:"domain-display",onClick:()=>l(!0),children:[(0,P.jsx)("span",{className:"badge badge-primary",children:s.domain||"No domain"}),(0,P.jsx)("span",{className:"edit-hint",children:"Click to edit"})]}):(0,P.jsx)("span",{className:"badge badge-primary",children:s.domain||"No domain"})}function Y(){const[e,s]=(0,a.useState)([]),[t,i]=(0,a.useState)(!0),[n,l]=(0,a.useState)(""),[o,r]=(0,a.useState)(""),[m,p]=(0,a.useState)("all"),[v,g]=(0,a.useState)("all"),[b,j]=(0,a.useState)(null),[N,f]=(0,a.useState)(!1),[y,w]=(0,a.useState)([]);(0,a.useEffect)(()=>(0,u.onSnapshot)((0,u.collection)(h.db,"tests"),e=>{const t=e.docs.map(e=>(0,d.A)({id:e.id},e.data()));s(t),i(!1)},e=>{l("Failed to load tests"),i(!1)}),[]);const k=e=>{j(e),f(!0),(async e=>{try{const s=(0,u.query)((0,u.collection)(h.db,"results"),(0,u.where)("testId","==",e)),t=await(0,u.getDocs)(s),a=await Promise.all(t.docs.map(async e=>{const s=(0,d.A)({id:e.id},e.data());if(s.candidateName&&s.candidateName.includes("@"))s.candidateName=s.candidateName.split("@")[0];else if(s.candidateId)try{const e=await(0,u.getDoc)((0,u.doc)(h.db,"user",s.candidateId));if(e.exists()){const t=e.data();t.name?s.candidateName=t.name:t.displayName?s.candidateName=t.displayName:t.fullName?s.candidateName=t.fullName:t.firstName?s.candidateName=t.firstName:t.email&&(s.candidateName=t.email.includes("@")?t.email.split("@")[0]:t.email)}else s.candidateName="Candidate ".concat(s.candidateId.slice(-4))}catch(n){console.error("Error fetching candidate name:",n),s.candidateName="Candidate ".concat(s.candidateId.slice(-4))}return s.candidateName||(s.candidateName="Unknown"),s}));w(a)}catch(s){l("Failed to load submissions")}})(e.id)},A=e.filter(e=>{var s,t;const a=(null===(s=e.title)||void 0===s?void 0:s.toLowerCase().includes(o.toLowerCase()))||(null===(t=e.domain)||void 0===t?void 0:t.toLowerCase().includes(o.toLowerCase())),i="all"===m||e.domain===m,n="all"===v||e.status===v;return a&&i&&n});return t?(0,P.jsx)("div",{className:"loading-tests",children:(0,P.jsx)(c.A,{message:"Loading tests",subtext:"Fetching all tests and submissions",variant:"inline",size:"large"})}):n?(0,P.jsxs)("div",{className:"error",children:["Error: ",n]}):b&&!N?(0,P.jsx)(V,{test:b,onBack:()=>j(null)}):b&&N?(0,P.jsx)(J,{test:b,submissions:y,onBack:()=>j(null)}):(0,P.jsxs)("div",{className:"admin-tests",children:[(0,P.jsxs)("div",{className:"tests-header",children:[(0,P.jsx)("h2",{children:"Test Management"}),(0,P.jsx)("p",{children:"Manage all tests, view papers, and monitor submissions"})]}),(0,P.jsxs)("div",{className:"tests-controls",children:[(0,P.jsx)("div",{className:"search-container",children:(0,P.jsx)("input",{type:"text",placeholder:"Search tests...",value:o,onChange:e=>r(e.target.value),className:"search-input"})}),(0,P.jsxs)("div",{className:"filters",children:[(0,P.jsxs)("select",{value:m,onChange:e=>p(e.target.value),className:"filter-select",children:[(0,P.jsx)("option",{value:"all",children:"All Domains"}),(0,P.jsx)("option",{value:"DSA",children:"DSA"}),(0,P.jsx)("option",{value:"Fullstack",children:"Fullstack"}),(0,P.jsx)("option",{value:"Java",children:"Java"}),(0,P.jsx)("option",{value:"Data Science",children:"Data Science"})]}),(0,P.jsxs)("select",{value:v,onChange:e=>g(e.target.value),className:"filter-select",children:[(0,P.jsx)("option",{value:"all",children:"All Status"}),(0,P.jsx)("option",{value:"active",children:"Active"}),(0,P.jsx)("option",{value:"inactive",children:"Inactive"})]})]})]}),(0,P.jsx)("div",{className:"tests-table-container",children:(0,P.jsxs)("table",{className:"tests-table",children:[(0,P.jsx)("thead",{children:(0,P.jsxs)("tr",{children:[(0,P.jsx)("th",{children:"Test Name"}),(0,P.jsx)("th",{children:"Domain"}),(0,P.jsx)("th",{children:"Status"}),(0,P.jsx)("th",{children:"Created"}),(0,P.jsx)("th",{children:"Actions"})]})}),(0,P.jsx)("tbody",{children:A.map(e=>(0,P.jsxs)("tr",{children:[(0,P.jsx)("td",{children:(0,P.jsxs)("div",{className:"test-info",children:[(0,P.jsx)("span",{className:"test-name",children:e.title}),(0,P.jsx)("span",{className:"test-duration",children:e.duration||"60 minutes"})]})}),(0,P.jsx)("td",{children:(0,P.jsx)("span",{className:"badge badge-primary",children:e.domain})}),(0,P.jsx)("td",{children:(0,P.jsx)("span",{className:"badge ".concat("active"===e.status?"badge-success":"badge-neutral"),children:e.status||"inactive"})}),(0,P.jsx)("td",{children:x(e.createdAt)}),(0,P.jsx)("td",{children:(0,P.jsxs)("div",{className:"test-actions",children:[(0,P.jsxs)("button",{className:"btn btn-sm btn-outline",onClick:()=>(e=>{j(e),f(!1)})(e),title:"View Test Paper",children:[(0,P.jsx)(O,{name:"paper",size:"small"})," Paper"]}),(0,P.jsxs)("button",{className:"btn btn-sm btn-outline",onClick:()=>k(e),title:"View Submissions",children:[(0,P.jsx)(O,{name:"submissions",size:"small"})," Submissions"]}),(0,P.jsxs)("button",{className:"btn btn-sm btn-danger",onClick:()=>(async e=>{if(window.confirm('Are you sure you want to delete the test "'.concat(e.title,'"?\n\n')+"This action will permanently delete:\n\u2022 The test and all its questions\n\u2022 All submissions and results for this test\n\u2022 This action cannot be undone!"))try{i(!0);const s=(0,u.query)((0,u.collection)(h.db,"results"),(0,u.where)("testId","==",e.id)),t=(await(0,u.getDocs)(s)).docs.map(e=>(0,u.deleteDoc)(e.ref));await Promise.all(t);const a=(0,u.collection)(h.db,"tests",e.id,"questions"),n=(await(0,u.getDocs)(a)).docs.map(e=>(0,u.deleteDoc)(e.ref));await Promise.all(n),await(0,u.deleteDoc)((0,u.doc)(h.db,"tests",e.id)),alert('Test "'.concat(e.title,'" has been successfully deleted.'))}catch(n){console.error("Error deleting test:",n),alert("Failed to delete test: ".concat(n.message))}finally{i(!1)}})(e),title:"Delete Test",disabled:t,children:[(0,P.jsx)(O,{name:"fire",size:"small"})," Delete"]})]})})]},e.id))})]})}),0===A.length&&(0,P.jsxs)("div",{className:"no-tests",children:[(0,P.jsx)("div",{className:"no-tests-icon",children:(0,P.jsx)(O,{name:"notebook",size:"2xl"})}),(0,P.jsx)("h3",{children:"No Tests Found"}),(0,P.jsx)("p",{children:"No tests match your current filters"})]})]})}function V(e){let{test:s,onBack:t}=e;const[i,n]=(0,a.useState)([]),[l,o]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{(async()=>{try{const e=(0,u.collection)(h.db,"tests",s.id,"questions"),t=(await(0,u.getDocs)(e)).docs.map(e=>{const s=e.data();return(0,d.A)({id:s.questionId||e.id,questionText:s.questionText,questionType:s.questionType,options:s.options||[],correctAnswer:s.correctAnswer,marks:s.marks||1,imageUrl:s.imageUrl||""},s)});t.sort((e,s)=>(parseInt(e.id)||0)-(parseInt(s.id)||0)),n(t),o(!1),console.log("Loaded questions for test paper:",t)}catch(e){console.error("Failed to load questions:",e),o(!1)}})()},[s.id]),l?(0,P.jsx)("div",{className:"loading-tests",children:(0,P.jsx)(c.A,{message:"Loading test paper",subtext:"Fetching questions and test structure",variant:"inline",size:"large"})}):(0,P.jsxs)("div",{className:"test-paper-view",children:[(0,P.jsxs)("div",{className:"paper-header",children:[(0,P.jsxs)("button",{className:"btn btn-outline",onClick:t,children:[(0,P.jsx)(O,{name:"leaderboard",size:"small"})," Back to Tests"]}),(0,P.jsxs)("div",{className:"paper-info",children:[(0,P.jsx)("h2",{children:s.title}),(0,P.jsxs)("div",{className:"paper-meta",children:[(0,P.jsxs)("span",{children:["Domain: ",s.domain]}),(0,P.jsxs)("span",{children:["Duration: ",s.duration||"60 minutes"]}),(0,P.jsxs)("span",{children:["Total Marks: ",s.totalMarks||"N/A"]})]})]})]}),(0,P.jsx)("div",{className:"questions-list",children:i.map((e,s)=>{var t;return(0,P.jsxs)("div",{className:"question-card",children:[(0,P.jsxs)("div",{className:"question-header",children:[(0,P.jsxs)("span",{className:"question-number",children:["Q",s+1]}),(0,P.jsxs)("div",{className:"question-meta",children:[(0,P.jsx)("span",{className:"question-type",children:(null===(t=e.questionType)||void 0===t?void 0:t.toUpperCase())||"MCQ"}),(0,P.jsxs)("span",{className:"question-marks",children:[e.marks||1," marks"]})]})]}),(0,P.jsxs)("div",{className:"question-content",children:[(0,P.jsx)("div",{className:"question-text",children:e.questionText||e.text||"No question text"}),e.imageUrl&&(0,P.jsx)("div",{className:"question-image",children:(0,P.jsx)("img",{src:e.imageUrl,alt:"Question illustration",style:{maxWidth:"100%",maxHeight:"300px",borderRadius:"8px",border:"1px solid #e5e7eb",marginTop:"1rem"},onError:e=>{e.target.style.display="none"}})}),"mcq"===e.questionType&&e.options&&e.options.length>0&&(0,P.jsxs)("div",{className:"question-options",children:[(0,P.jsx)("h4",{children:"Options:"}),e.options.map((s,t)=>(0,P.jsxs)("div",{className:"option ".concat(s===e.correctAnswer?"correct-option":""),children:[(0,P.jsxs)("span",{className:"option-label",children:[String.fromCharCode(65+t),"."]}),(0,P.jsx)("span",{className:"option-text",children:s}),s===e.correctAnswer&&(0,P.jsxs)("span",{className:"correct-indicator",children:[(0,P.jsx)(O,{name:"success",size:"small"})," Correct"]})]},t))]}),"long"===e.questionType&&(0,P.jsxs)("div",{className:"long-answer-info",children:[(0,P.jsxs)("p",{children:[(0,P.jsx)("strong",{children:"Type:"})," Long Answer Question"]}),(0,P.jsxs)("p",{children:[(0,P.jsx)("strong",{children:"Expected:"})," Detailed written response"]})]}),"code"===e.questionType&&(0,P.jsxs)("div",{className:"code-question-info",children:[(0,P.jsxs)("p",{children:[(0,P.jsx)("strong",{children:"Type:"})," Programming Question"]}),(0,P.jsxs)("p",{children:[(0,P.jsx)("strong",{children:"Expected:"})," Code implementation"]}),e.expectedAnswer&&(0,P.jsxs)("div",{className:"expected-solution",children:[(0,P.jsx)("strong",{children:"Sample Solution:"}),(0,P.jsx)("pre",{style:{background:"#f8f9fa",padding:"1rem",borderRadius:"4px",overflow:"auto",marginTop:"0.5rem"},children:e.expectedAnswer})]})]})]})]},e.id)})}),0===i.length&&(0,P.jsx)("div",{className:"no-questions",children:(0,P.jsx)("p",{children:"No questions found for this test"})})]})}function J(e){var s,t;let{test:i,submissions:l,onBack:o}=e;const[c,d]=(0,a.useState)(""),[r,p]=(0,a.useState)(null),[v,g]=(0,a.useState)(!1),{user:b}=(0,n.D)(),[N,f]=(0,a.useState)(l||[]);(0,a.useEffect)(()=>{f(l||[])},[l]);const w="admin"===(null===b||void 0===b?void 0:b.role)||"head"===(null===b||void 0===b?void 0:b.role)||(null===b||void 0===b||null===(s=b.email)||void 0===s||null===(t=s.toLowerCase)||void 0===t?void 0:t.call(s))===m.UO.superAdminEmail.toLowerCase(),k=N.filter(e=>{var s,t;return(null===(s=e.candidateId)||void 0===s?void 0:s.toLowerCase().includes(c.toLowerCase()))||(null===(t=e.candidateName)||void 0===t?void 0:t.toLowerCase().includes(c.toLowerCase()))});return r?(0,P.jsx)(Z,{submission:r,test:i,onBack:()=>p(null)}):(0,P.jsxs)("div",{className:"test-submissions-view",children:[(0,P.jsxs)("div",{className:"submissions-header",children:[(0,P.jsxs)("button",{className:"btn btn-outline",onClick:o,children:[(0,P.jsx)(O,{name:"leaderboard",size:"small"})," Back to Tests"]}),(0,P.jsxs)("div",{className:"submissions-info",children:[(0,P.jsxs)("h2",{children:["Submissions: ",i.title]}),(0,P.jsxs)("p",{children:[N.length," total submissions"]})]})]}),(0,P.jsxs)("div",{className:"submissions-controls",children:[(0,P.jsx)("input",{type:"text",placeholder:"Search by candidate ID or name...",value:c,onChange:e=>d(e.target.value),className:"search-input"}),(0,P.jsxs)("div",{className:"export-actions",children:[(0,P.jsxs)("button",{className:"btn btn-outline ".concat(v?"btn-loading":""),onClick:()=>j({submissions:N,selectedTest:i,setLoading:g}),disabled:v||0===N.length,title:"Export submissions to Excel",children:[(0,P.jsx)(O,{name:"notebook",size:"small"})," Export Excel"]}),(0,P.jsxs)("button",{className:"btn btn-outline ".concat(v?"btn-loading":""),onClick:()=>y({submissions:N,selectedTest:i,setLoading:g,exportType:"admin"}),disabled:v||0===N.length,title:"Export submissions to PDF",style:{marginLeft:"8px"},children:[(0,P.jsx)(O,{name:"paper",size:"small"})," Export PDF"]})]})]}),(0,P.jsx)("div",{className:"submissions-table-container",children:(0,P.jsxs)("table",{className:"submissions-table",children:[(0,P.jsx)("thead",{children:(0,P.jsxs)("tr",{children:[(0,P.jsx)("th",{children:"Candidate"}),(0,P.jsx)("th",{children:"Submission Time"}),(0,P.jsx)("th",{children:"Score"}),(0,P.jsx)("th",{children:"Status"}),(0,P.jsx)("th",{children:"Actions"})]})}),(0,P.jsx)("tbody",{children:k.map(e=>(0,P.jsxs)("tr",{children:[(0,P.jsx)("td",{children:(0,P.jsx)("div",{className:"candidate-info",children:(0,P.jsx)("span",{className:"candidate-name",children:e.candidateName||"Unknown"})})}),(0,P.jsx)("td",{children:x(e.submittedAt)}),(0,P.jsx)("td",{children:(0,P.jsx)("span",{className:"score",children:(()=>{if(console.log("Score Debug:",{candidateName:e.candidateName,totalMarksAwarded:e.totalMarksAwarded,maxPossibleMarks:e.maxPossibleMarks,testTotalMarks:null===i||void 0===i?void 0:i.totalMarks,score:e.score,evaluatedBy:e.evaluatedBy}),void 0!==e.totalMarksAwarded&&null!==e.totalMarksAwarded){let s=(null===i||void 0===i?void 0:i.totalMarks)||100;return e.totalMarksAwarded>s&&s<50&&(s=100,console.warn("Data issue detected: totalMarksAwarded > testTotalMarks, using 100 as fallback")),"".concat(e.totalMarksAwarded,"/").concat(s)}if(void 0!==e.score){const s=(null===i||void 0===i?void 0:i.totalMarks)||100,t=Math.round(e.score/100*s);return"".concat(t,"/").concat(s," (").concat(e.score,"%)")}return"Not graded"})()})}),(0,P.jsx)("td",{children:(0,P.jsx)("span",{className:"badge ".concat("evaluated"===e.status?"badge-success":"badge-warning"),children:e.status||"submitted"})}),(0,P.jsxs)("td",{children:[(0,P.jsxs)("button",{className:"btn btn-sm btn-outline",title:"View Details",onClick:()=>p(e),children:[(0,P.jsx)(O,{name:"computer",size:"small"})," View"]}),w&&(0,P.jsxs)("button",{className:"btn btn-sm btn-danger",title:"Delete Submission",style:{marginLeft:"0.5rem"},onClick:()=>(async e=>{if(!w)return void alert("You do not have permission to delete submissions");if(window.confirm('Delete submission for "'.concat(e.candidateName||e.candidateId,'"?\n\n')+"This will permanently remove:\n"+'\u2022 Their test result for "'.concat(i.title,'"\n')+"\u2022 All monitoring logs for this test attempt\n\u2022 All paste/tab switch logs for this test\n\nThis action cannot be undone. Continue?"))try{console.log("Deleting submission and related data for:",e.candidateId,"test:",i.id),await(0,u.deleteDoc)((0,u.doc)(h.db,"results",e.id)),console.log("\u2705 Deleted main submission");const s=(0,u.query)((0,u.collection)(h.db,"monitoring"),(0,u.where)("candidateId","==",e.candidateId),(0,u.where)("testId","==",i.id)),t=await(0,u.getDocs)(s),a=t.docs.map(e=>(0,u.deleteDoc)(e.ref));await Promise.all(a),console.log("\u2705 Deleted ".concat(t.size," monitoring logs"));const n=(0,u.query)((0,u.collection)(h.db,"pasteLogs"),(0,u.where)("candidateId","==",e.candidateId),(0,u.where)("testId","==",i.id)),l=await(0,u.getDocs)(n),o=l.docs.map(e=>(0,u.deleteDoc)(e.ref));await Promise.all(o),console.log("\u2705 Deleted ".concat(l.size," paste logs"));const c=(0,u.query)((0,u.collection)(h.db,"tabSwitchLogs"),(0,u.where)("candidateId","==",e.candidateId),(0,u.where)("testId","==",i.id)),d=await(0,u.getDocs)(c),r=d.docs.map(e=>(0,u.deleteDoc)(e.ref));await Promise.all(r),console.log("\u2705 Deleted ".concat(d.size," tab switch logs")),f(s=>s.filter(s=>s.id!==e.id)),p(null);const m=1+t.size+l.size+d.size;alert("Submission and all related data deleted successfully!\n\nDeleted ".concat(m," records total:\n\u2022 1 submission result\n\u2022 ").concat(t.size," monitoring logs\n\u2022 ").concat(l.size," paste logs\n\u2022 ").concat(d.size," tab switch logs"))}catch(s){console.error("Error deleting submission and related data:",s),alert("Failed to delete submission: "+(s.message||"Unknown error"))}})(e),children:[(0,P.jsx)(O,{name:"fire",size:"small"})," Delete"]})]})]},e.id))})]})}),0===k.length&&(0,P.jsxs)("div",{className:"no-submissions",children:[(0,P.jsx)("div",{className:"no-submissions-icon",children:"\ud83d\udcca"}),(0,P.jsx)("h3",{children:"No Submissions Found"}),(0,P.jsx)("p",{children:"No submissions match your search criteria"})]})]})}function Z(e){let{submission:s,test:t,onBack:i}=e;const[n,l]=(0,a.useState)([]),[o,r]=(0,a.useState)(!0),[m,p]=(0,a.useState)({}),[v,g]=(0,a.useState)(0),[b,j]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{try{const e=(0,u.collection)(h.db,"tests",t.id,"questions"),a=(await(0,u.getDocs)(e)).docs.map(e=>{const s=e.data();return(0,d.A)({id:s.questionId||e.id,questionText:s.questionText,questionType:s.questionType,options:s.options||[],correctAnswer:s.correctAnswer,marks:s.marks||1,imageUrl:s.imageUrl||""},s)});a.sort((e,s)=>(parseInt(e.id)||0)-(parseInt(s.id)||0));const i=a.map(e=>{var t;const a=(null===(t=s.answers)||void 0===t?void 0:t[e.id])||"";return(0,d.A)((0,d.A)({},e),{},{candidateAnswer:a,isCorrect:"mcq"===e.questionType?a===e.correctAnswer:null})}),n={};let o=0;i.forEach(e=>{var t;const a=null===(t=s.questionMarks)||void 0===t?void 0:t[e.id];void 0!==a?(n[e.id]=a,o+=a):n[e.id]=0}),l(i),p(n),g(o),r(!1)}catch(e){console.error("Error loading submission details:",e),r(!1)}})()},[s,t.id]);return o?(0,P.jsx)("div",{className:"loading-tests",children:(0,P.jsx)(c.A,{message:"Loading submission details",subtext:"Fetching candidate answers and question data",variant:"inline",size:"large"})}):(0,P.jsxs)("div",{className:"submission-detail-view",children:[(0,P.jsxs)("div",{className:"submission-header",children:[(0,P.jsxs)("button",{className:"btn btn-outline",onClick:i,children:[(0,P.jsx)(O,{name:"submissions",size:"small"})," Back to Submissions"]}),(0,P.jsxs)("div",{className:"submission-info",children:[(0,P.jsx)("h2",{children:"Submission Details"}),(0,P.jsxs)("div",{className:"submission-meta",children:[(0,P.jsxs)("div",{className:"meta-item",children:[(0,P.jsx)("strong",{children:"Candidate:"})," ",s.candidateName||"Unknown"]}),(0,P.jsxs)("div",{className:"meta-item",children:[(0,P.jsx)("strong",{children:"Test:"})," ",t.title]}),(0,P.jsxs)("div",{className:"meta-item",children:[(0,P.jsx)("strong",{children:"Submitted:"})," ",x(s.submittedAt)]}),(0,P.jsxs)("div",{className:"meta-item",children:[(0,P.jsx)("strong",{children:"Score:"})," ",(()=>{if(void 0!==s.totalMarksAwarded&&null!==s.totalMarksAwarded){let e=(null===t||void 0===t?void 0:t.totalMarks)||100;return s.totalMarksAwarded>e&&e<50&&(e=100),"".concat(s.totalMarksAwarded,"/").concat(e," marks")}if(void 0!==s.score){const e=(null===t||void 0===t?void 0:t.totalMarks)||100,a=Math.round(s.score/100*e);return"".concat(a,"/").concat(e," marks (").concat(s.score,"%)")}return"Not graded"})()]}),(0,P.jsxs)("div",{className:"meta-item",children:[(0,P.jsx)("strong",{children:"Status:"}),(0,P.jsx)("span",{className:"badge ".concat("evaluated"===s.status?"badge-success":"badge-warning"),children:s.status||"submitted"})]})]})]}),(0,P.jsxs)("div",{className:"marks-summary-header",children:[(0,P.jsxs)("div",{className:"marks-total-display",children:[(0,P.jsx)("span",{className:"marks-total-label",children:"Total Marks:"}),(0,P.jsxs)("span",{className:"marks-total-value",children:[v," / ",n.reduce((e,s)=>e+(s.marks||1),0)]}),(0,P.jsxs)("span",{className:"marks-percentage",children:["(",n.reduce((e,s)=>e+(s.marks||1),0)>0?Math.round(v/n.reduce((e,s)=>e+(s.marks||1),0)*100):0,"%)"]})]}),(0,P.jsx)("div",{className:"marks-actions",children:(0,P.jsx)("button",{className:"btn btn-primary ".concat(b?"btn-loading":""),onClick:async()=>{j(!0);try{const e=n.reduce((e,s)=>e+(s.marks||1),0),t=e>0?Math.round(v/e*100):0,a=(0,u.doc)(h.db,"results",s.id);await(0,u.updateDoc)(a,{questionMarks:m,totalMarksAwarded:v,maxPossibleMarks:e,score:t,status:"evaluated",evaluatedAt:(0,u.serverTimestamp)(),evaluatedBy:"admin"}),alert("Marks saved successfully!")}catch(e){console.error("Error saving marks:",e),alert("Failed to save marks. Please try again.")}finally{j(!1)}},disabled:b,children:b?"Saving...":(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(O,{name:"shield",size:"small"})," Save All Marks"]})})})]})]}),(0,P.jsx)("div",{className:"submission-questions",children:n.map((e,s)=>{var t;return(0,P.jsxs)("div",{className:"submission-question-card",children:[(0,P.jsxs)("div",{className:"question-header",children:[(0,P.jsxs)("div",{className:"question-title-section",children:[(0,P.jsxs)("span",{className:"question-number",children:["Q",s+1]}),(0,P.jsxs)("div",{className:"question-meta",children:[(0,P.jsx)("span",{className:"question-type",children:(null===(t=e.questionType)||void 0===t?void 0:t.toUpperCase())||"MCQ"}),(0,P.jsxs)("span",{className:"question-marks",children:["Max: ",e.marks||1," marks"]}),"mcq"===e.questionType&&(0,P.jsxs)("div",{className:"mcq-answer-preview",children:[(0,P.jsxs)("span",{className:"candidate-choice",children:["Choice: ",e.candidateAnswer||"None"]}),(0,P.jsx)("span",{className:"answer-status ".concat(e.isCorrect?"correct":"incorrect"),children:e.isCorrect?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(O,{name:"success",size:"small"})," Correct"]}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(O,{name:"fire",size:"small"})," Incorrect"]})})]})]})]}),(0,P.jsx)("div",{className:"marks-input-section",children:(0,P.jsxs)("div",{className:"marks-input-container",children:[(0,P.jsx)("label",{className:"marks-label",children:"Marks Awarded:"}),(0,P.jsxs)("div",{className:"marks-input-wrapper",children:[(0,P.jsx)("input",{type:"number",min:"0",max:e.marks||1,step:"0.5",value:m[e.id]||0,onChange:s=>((e,s)=>{var t;const a=Math.max(0,parseFloat(s)||0),i=(null===(t=n.find(s=>s.id===e))||void 0===t?void 0:t.marks)||1,l=Math.min(a,i);p(s=>(0,d.A)((0,d.A)({},s),{},{[e]:l}));const o=Object.values((0,d.A)((0,d.A)({},m),{},{[e]:l})).reduce((e,s)=>e+(s||0),0);g(o)})(e.id,s.target.value),className:"marks-input"}),(0,P.jsxs)("span",{className:"marks-max",children:["/ ",e.marks||1]})]}),"mcq"===e.questionType&&null!==e.isCorrect&&(0,P.jsx)("span",{className:"mcq-result-indicator ".concat(e.isCorrect?"correct":"incorrect"),children:e.isCorrect?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(O,{name:"success",size:"small"})," Correct Answer"]}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(O,{name:"fire",size:"small"})," Wrong Answer"]})})]})})]}),(0,P.jsxs)("div",{className:"question-content",children:[(0,P.jsx)("div",{className:"question-text",children:e.questionText||"No question text"}),e.imageUrl&&(0,P.jsx)("div",{className:"question-image",children:(0,P.jsx)("img",{src:e.imageUrl,alt:"Question illustration",style:{maxWidth:"100%",maxHeight:"300px",borderRadius:"8px",border:"1px solid #e5e7eb",marginTop:"1rem"},onError:e=>{e.target.style.display="none"}})}),"mcq"===e.questionType&&(0,P.jsxs)("div",{className:"mcq-section",children:[(0,P.jsxs)("div",{className:"candidate-answer-display",children:[(0,P.jsx)("h4",{children:"Candidate's Answer:"}),(0,P.jsxs)("div",{className:"candidate-selected-answer ".concat(e.isCorrect?"correct":"incorrect"),children:[(0,P.jsx)("span",{className:"selected-option-text",children:e.candidateAnswer||"No answer selected"}),(0,P.jsx)("span",{className:"answer-result ".concat(e.isCorrect?"correct":"incorrect"),children:e.isCorrect?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(O,{name:"success",size:"small"})," Correct"]}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(O,{name:"fire",size:"small"})," Incorrect"]})})]})]}),(0,P.jsxs)("div",{className:"question-options",children:[(0,P.jsx)("h4",{children:"All Options:"}),e.options.map((s,t)=>(0,P.jsxs)("div",{className:"option ".concat(s===e.correctAnswer?"correct-option":""," ").concat(s===e.candidateAnswer?"selected-option":""),children:[(0,P.jsxs)("span",{className:"option-label",children:[String.fromCharCode(65+t),"."]}),(0,P.jsx)("span",{className:"option-text",children:s}),s===e.correctAnswer&&(0,P.jsxs)("span",{className:"correct-indicator",children:[(0,P.jsx)(O,{name:"success",size:"small"})," Correct Answer"]}),s===e.candidateAnswer&&s!==e.correctAnswer&&(0,P.jsx)("span",{className:"selected-indicator",children:"\u2190 Candidate Selected"}),s===e.candidateAnswer&&s===e.correctAnswer&&(0,P.jsx)("span",{className:"both-indicator",children:"\u2190 Candidate Selected (Correct!)"})]},t))]})]}),("long"===e.questionType||"code"===e.questionType)&&(0,P.jsxs)("div",{className:"text-answer-section",children:[(0,P.jsx)("h4",{children:"Candidate's Answer:"}),(0,P.jsx)("div",{className:"candidate-answer",children:e.candidateAnswer?(0,P.jsx)("pre",{style:{background:"#f8f9fa",padding:"1rem",borderRadius:"8px",border:"1px solid #e5e7eb",whiteSpace:"pre-wrap",fontFamily:"code"===e.questionType?"monospace":"inherit"},children:e.candidateAnswer}):(0,P.jsx)("div",{className:"no-answer",children:"No answer provided"})})]})]})]},e.id)})}),0===n.length&&(0,P.jsx)("div",{className:"no-questions",children:(0,P.jsx)("p",{children:"No questions found for this submission"})})]})}function K(){const[e,s]=(0,a.useState)([]),[t,i]=(0,a.useState)(null),[n,l]=(0,a.useState)([]),[o,r]=(0,a.useState)(null),[m,x]=(0,a.useState)([]),[p,v]=(0,a.useState)({}),[g,b]=(0,a.useState)(!0),[j,N]=(0,a.useState)("");(0,a.useEffect)(()=>(0,u.onSnapshot)((0,u.collection)(h.db,"tests"),e=>{const t=e.docs.map(e=>(0,d.A)({id:e.id},e.data()));s(t),b(!1)},e=>{console.error("Error loading tests for monitoring:",e),N("Failed to load tests"),b(!1)}),[]);const f=async(e,s)=>{console.log("\ud83d\udd0d ADMIN MONITORING: Loading monitoring data for test:",e),console.log("\ud83d\udd0d ADMIN MONITORING: Participants:",s.map(e=>({id:e.id,candidateId:e.candidateId,name:e.candidateName})));try{const t=s.map(async s=>{if(!s.candidateId)return console.log("\ud83d\udd0d ADMIN MONITORING: Skipping participant without candidateId:",s.id),{[s.id]:{}};console.log("\ud83d\udd0d ADMIN MONITORING: Querying monitoring for candidate ".concat(s.candidateId));const t=(0,u.query)((0,u.collection)(h.db,"monitoring"),(0,u.where)("candidateId","==",s.candidateId),(0,u.where)("testId","==",e)),a=(await(0,u.getDocs)(t)).docs.map(e=>(0,d.A)({id:e.id},e.data()));console.log("\ud83d\udd0d ADMIN MONITORING: Found ".concat(a.length," events for candidate ").concat(s.candidateId,":"),a);const i={tabSwitches:a.filter(e=>"tab_switch"===e.type||"visibility_change"===e.type),copyEvents:a.filter(e=>"copy"===e.type),pasteEvents:a.filter(e=>"paste"===e.type),totalViolations:a.length,lastActivity:a.length>0?Math.max(...a.map(e=>{var s;return(null===(s=e.timestamp)||void 0===s?void 0:s.toMillis())||0})):null};return console.log("\ud83d\udd0d ADMIN MONITORING: Aggregated data for ".concat(s.candidateId,":"),i),{[s.id]:i}}),a=(await Promise.all(t)).reduce((e,s)=>(0,d.A)((0,d.A)({},e),s),{});console.log("\ud83d\udd0d ADMIN MONITORING: Final monitoring map:",a),v(a)}catch(t){console.error("\u274c ADMIN MONITORING: Error loading monitoring data:",t)}},y=e=>{i(e),r(null),v({}),(async e=>{try{const s=(0,u.query)((0,u.collection)(h.db,"results"),(0,u.where)("testId","==",e)),t=(0,u.onSnapshot)(s,async s=>{const t=await Promise.all(s.docs.map(async e=>{const s=(0,d.A)({id:e.id},e.data());if(s.candidateName&&s.candidateName.includes("@"))s.candidateName=s.candidateName.split("@")[0];else if(s.candidateId)try{const e=await(0,u.getDoc)((0,u.doc)(h.db,"user",s.candidateId));if(e.exists()){const t=e.data();t.name?s.candidateName=t.name:t.displayName?s.candidateName=t.displayName:t.fullName?s.candidateName=t.fullName:t.firstName?s.candidateName=t.firstName:t.email&&(s.candidateName=t.email.includes("@")?t.email.split("@")[0]:t.email)}else s.candidateName="Candidate ".concat(s.candidateId.slice(-4))}catch(j){console.error("Error fetching candidate name:",j),s.candidateName="Candidate ".concat(s.candidateId.slice(-4))}return s.candidateName||(s.candidateName="Unknown"),s}));l(t),f(e,t)});return t}catch(s){console.error("Error loading participants:",s),N("Failed to load participants")}})(e.id)},w=e=>{r(e),(async(e,s)=>{try{const t=(0,u.query)((0,u.collection)(h.db,"monitoring"),(0,u.where)("candidateId","==",e),(0,u.where)("testId","==",s));return(0,u.onSnapshot)(t,e=>{const s=e.docs.map(e=>(0,d.A)({id:e.id},e.data()));x(s)})}catch(t){console.error("Error loading monitoring data:",t),N("Failed to load monitoring data")}})(e.candidateId,t.id)},k=e=>(e=>{var s,t,a;const i=p[e.id]||{};return((null===(s=i.tabSwitches)||void 0===s?void 0:s.length)||0)+((null===(t=i.copyEvents)||void 0===t?void 0:t.length)||0)+((null===(a=i.pasteEvents)||void 0===a?void 0:a.length)||0)})(e)>3,A=e=>{var s,t,a;const i=p[e.id]||{};return{tabSwitches:(null===(s=i.tabSwitches)||void 0===s?void 0:s.length)||0,copyEvents:(null===(t=i.copyEvents)||void 0===t?void 0:t.length)||0,pasteEvents:(null===(a=i.pasteEvents)||void 0===a?void 0:a.length)||0,totalViolations:i.totalViolations||0,lastActivity:i.lastActivity}};return g?(0,P.jsx)("div",{className:"loading-tests",children:(0,P.jsx)(c.A,{message:"Loading monitoring data",subtext:"Analyzing test activities and security logs",variant:"inline",size:"large"})}):j?(0,P.jsxs)("div",{className:"error",children:["Error: ",j]}):o?(0,P.jsx)($,{participant:o,test:t,monitoringData:m,onBack:()=>r(null)}):t?(0,P.jsxs)("div",{className:"participants-monitoring",children:[(0,P.jsxs)("div",{className:"monitoring-header",children:[(0,P.jsxs)("button",{className:"btn btn-outline",onClick:()=>i(null),children:[(0,P.jsx)(O,{name:"leaderboard",size:"small"})," Back to Tests"]}),(0,P.jsxs)("div",{className:"test-info",children:[(0,P.jsxs)("h2",{children:["Monitoring: ",t.title]}),(0,P.jsxs)("p",{children:[n.length," participants being monitored"]})]})]}),(0,P.jsx)("div",{className:"participants-table-container",children:(0,P.jsxs)("table",{className:"participants-table",children:[(0,P.jsx)("thead",{children:(0,P.jsxs)("tr",{children:[(0,P.jsx)("th",{children:"Participant"}),(0,P.jsx)("th",{children:"Status"}),(0,P.jsx)("th",{children:"Tab Switches"}),(0,P.jsx)("th",{children:"Copy Events"}),(0,P.jsx)("th",{children:"Paste Events"}),(0,P.jsx)("th",{children:"Risk Level"}),(0,P.jsx)("th",{children:"Actions"})]})}),(0,P.jsx)("tbody",{children:n.map(e=>(0,P.jsxs)("tr",{className:k(e)?"suspicious-row":"",children:[(0,P.jsx)("td",{children:(0,P.jsx)("div",{className:"participant-info",children:(0,P.jsx)("span",{className:"participant-name",children:e.candidateName||"Unknown"})})}),(0,P.jsx)("td",{children:(0,P.jsx)("span",{className:"badge ".concat("blocked"===e.status||e.blocked?"badge-error":"in_progress"===e.status||"active"===e.status?"badge-success":"badge-neutral"),children:"blocked"===e.status||e.blocked?"Blocked":"in_progress"===e.status?"In Progress":"active"===e.status?"Active":"completed"===e.status?"Completed":"Unknown"})}),(0,P.jsx)("td",{children:(0,P.jsx)("span",{className:"activity-count ".concat(A(e).tabSwitches>2?"high":""),children:A(e).tabSwitches})}),(0,P.jsx)("td",{children:(0,P.jsx)("span",{className:"activity-count ".concat(A(e).copyEvents>1?"high":""),children:A(e).copyEvents})}),(0,P.jsx)("td",{children:(0,P.jsx)("span",{className:"activity-count ".concat(A(e).pasteEvents>1?"high":""),children:A(e).pasteEvents})}),(0,P.jsx)("td",{children:(0,P.jsx)("span",{className:"risk-level ".concat(k(e)?"high":"low"),children:k(e)?"\ud83d\udd34 High":"\ud83d\udfe2 Low"})}),(0,P.jsx)("td",{children:(0,P.jsxs)("button",{className:"btn btn-sm btn-outline",onClick:()=>w(e),title:"View Details",children:[(0,P.jsx)(O,{name:"computer",size:"small"})," Details"]})})]},e.id))})]})}),0===n.length&&(0,P.jsxs)("div",{className:"no-participants",children:[(0,P.jsx)("div",{className:"no-participants-icon",children:"\ud83d\udc65"}),(0,P.jsx)("h3",{children:"No Participants"}),(0,P.jsx)("p",{children:"No participants found for this test"})]})]}):(0,P.jsxs)("div",{className:"admin-monitoring",children:[(0,P.jsxs)("div",{className:"monitoring-header",children:[(0,P.jsx)("h2",{children:"Real-time Monitoring"}),(0,P.jsx)("p",{children:"Monitor test participants and detect suspicious activities"})]}),(0,P.jsx)("div",{className:"tests-monitoring-grid",children:e.map(e=>(0,P.jsxs)("div",{className:"test-monitoring-card",onClick:()=>y(e),children:[(0,P.jsxs)("div",{className:"test-header",children:[(0,P.jsx)("h3",{children:e.title}),(0,P.jsx)("span",{className:"badge ".concat("active"===e.status?"badge-success":"badge-neutral"),children:e.status||"inactive"})]}),(0,P.jsxs)("div",{className:"test-details",children:[(0,P.jsxs)("div",{className:"test-meta",children:[(0,P.jsxs)("span",{children:["Domain: ",e.domain]}),(0,P.jsxs)("span",{children:["Participants: ",e.participantCount||0]})]}),(0,P.jsx)("div",{className:"monitoring-stats",children:(0,P.jsxs)("span",{className:"stat",children:[(0,P.jsx)("span",{className:"stat-icon",children:(0,P.jsx)(O,{name:"computer",size:"small"})}),(0,P.jsx)("span",{children:"Click to monitor"})]})})]})]},e.id))}),0===e.length&&(0,P.jsxs)("div",{className:"no-tests",children:[(0,P.jsx)("div",{className:"no-tests-icon",children:(0,P.jsx)(O,{name:"notebook",size:"2xl"})}),(0,P.jsx)("h3",{children:"No Tests Available"}),(0,P.jsx)("p",{children:"No tests available for monitoring"})]})]})}function X(e){var s,t,a,i,n;let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e)return"Unknown Question";if(o&&"Question text not available"!==o){const e=o.replace(/<[^>]*>/g,"").replace(/\s+/g," ").trim(),s=e.slice(0,100);return'"'.concat(s).concat(e.length>100?"...":"",'"')}if(console.log("\ud83d\udd0d Getting question name for:",e,"Test data:",null===l||void 0===l||null===(s=l.questions)||void 0===s?void 0:s.length),console.log("\ud83d\udd0d Available questions:",null===l||void 0===l||null===(t=l.questions)||void 0===t?void 0:t.map(e=>({id:e.id,hasQuestionText:!!e.questionText,hasQuestion:!!e.question,hasText:!!e.text}))),console.log("\ud83d\udd0d All question IDs:",null===l||void 0===l||null===(a=l.questions)||void 0===a?void 0:a.map(e=>e.id)),console.log("\ud83d\udd0d Question ID types:",null===l||void 0===l||null===(i=l.questions)||void 0===i?void 0:i.map(e=>({id:e.id,type:typeof e.id}))),console.log("\ud83d\udd0d Looking for ID type:",typeof e),(null===l||void 0===l||null===(n=l.questions)||void 0===n?void 0:n.length)>0&&console.log("\ud83d\udd0d Available question texts:",l.questions.map(e=>({id:e.id,text:(e.questionText||e.question||e.text||"No text").substring(0,50)+"..."}))),e.includes("_notes")){const s=e.replace("_notes","");if(null!==l&&void 0!==l&&l.questions){var c,d,r;let e=l.questions.find(e=>e.id===s);if(console.log("\ud83d\udd0d Found question for notes (exact match):",e),e||(e=l.questions.find(e=>e.id.includes(s)||s.includes(e.id)),console.log("\ud83d\udd0d Found question for notes (partial match):",e)),!e){const t=String(s);e=l.questions.find(e=>String(e.id)===t||String(e.id).includes(t)||t.includes(String(e.id))),console.log("\ud83d\udd0d Found question for notes (string match):",e)}console.log("\ud83d\udd0d Notes question properties:",e?Object.keys(e):"No question found");const t=(null===(c=e)||void 0===c?void 0:c.questionText)||(null===(d=e)||void 0===d?void 0:d.question)||(null===(r=e)||void 0===r?void 0:r.text);if(console.log("\ud83d\udd0d Notes question text found:",t?t.substring(0,50)+"...":"No text found"),t){const e=t.replace(/<[^>]*>/g,"").replace(/\s+/g," ").trim(),s=e.slice(0,80);return'"'.concat(s).concat(e.length>80?"...":"",'" (Notes Field)')}}return"Question ".concat(s.slice(0,8),"... (Notes Field)")}if(null!==l&&void 0!==l&&l.questions){var u,m,h;let s=l.questions.find(s=>s.id===e);if(console.log("\ud83d\udd0d Found question (exact match):",s),s||(s=l.questions.find(s=>s.id.includes(e)||e.includes(s.id)),console.log("\ud83d\udd0d Found question (partial match):",s)),!s){const t=String(e);console.log("\ud83d\udd0d Trying string conversion - looking for:",t),console.log("\ud83d\udd0d Available IDs as strings:",l.questions.map(e=>String(e.id))),s=l.questions.find(e=>String(e.id)===t||String(e.id).includes(t)||t.includes(String(e.id))),console.log("\ud83d\udd0d Found question (string match):",s)}if(!s){console.log("\ud83d\udd0d Trying any partial match...");for(let t=0;t<l.questions.length;t++){const a=l.questions[t];if(console.log('\ud83d\udd0d Comparing "'.concat(e,'" with "').concat(a.id,'" (').concat(typeof a.id,")")),String(a.id)===String(e)){s=a,console.log("\ud83d\udd0d Found exact match!",s);break}}}if(!s&&e.length>10){console.log("\ud83d\udd0d Trying timestamp-based matching...");const t=parseInt(e);if(!isNaN(t)){let a=null,i=1/0;for(const e of l.questions){const s=parseInt(e.id);if(!isNaN(s)){const n=Math.abs(t-s);n<i&&(i=n,a=e)}}var x;if(a&&i<36e5)s=a,console.log("\ud83d\udd0d Found timestamp-based match!",{target:e,found:s.id,diff:i,question:(null===(x=s.questionText)||void 0===x?void 0:x.substring(0,50))+"..."})}}console.log("\ud83d\udd0d Question properties:",s?Object.keys(s):"No question found");const t=(null===(u=s)||void 0===u?void 0:u.questionText)||(null===(m=s)||void 0===m?void 0:m.question)||(null===(h=s)||void 0===h?void 0:h.text);if(console.log("\ud83d\udd0d Question text found:",t?t.substring(0,50)+"...":"No text found"),t){const e=t.replace(/<[^>]*>/g,"").replace(/\s+/g," ").trim(),s=e.slice(0,100);return'"'.concat(s).concat(e.length>100?"...":"",'"')}}if(e.length>10){var p;if(console.log("\ud83d\udd0d Falling back to ID display for:",e),console.log("\ud83d\udd0d This question ID does not exist in current test data"),(null===l||void 0===l||null===(p=l.questions)||void 0===p?void 0:p.length)>0){const e=l.questions[0],s=(null===e||void 0===e?void 0:e.questionText)||(null===e||void 0===e?void 0:e.question)||(null===e||void 0===e?void 0:e.text);if(s)return console.log("\ud83d\udd0d Showing first available question as reference:",s.substring(0,50)+"...")," ".concat(s.substring(0,50)).concat(s.length>50?"...":"")}return"Question ".concat(e.slice(0,8),"... (ID not found in current test)")}return console.log("\ud83d\udd0d Using short ID display for:",e),"Question ".concat(e," (ID not found in current test)")}function $(e){let{participant:s,test:t,monitoringData:i,onBack:n}=e;const[l,o]=(0,a.useState)("overview"),[c,r]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{if(null!==t&&void 0!==t&&t.id)try{console.log("\ud83d\udd0d Loading test questions for:",t.id);const e=(0,u.query)((0,u.collection)(h.db,"tests"),(0,u.where)("__name__","==",t.id)),s=await(0,u.getDocs)(e);if(!s.empty){const e=s.docs[0],a=(0,d.A)({id:e.id},e.data()),i=(0,u.collection)(h.db,"tests",t.id,"questions"),n=(await(0,u.getDocs)(i)).docs.map(e=>(0,d.A)({id:e.id},e.data()));a.questions=n,r(a),console.log("\u2705 Loaded test with questions:",a)}}catch(e){console.error("Error loading test questions:",e),r(t)}})()},[t]);const m=i.filter(e=>"tab_switch"===e.type||"visibility_change"===e.type||"focus_lost"===e.type),p=i.filter(e=>"copy"===e.type),v=i.filter(e=>"paste"===e.type),g=i.filter(e=>"keyboard_shortcut"===e.type),b=i.filter(e=>"right_click"===e.type);return(0,P.jsxs)("div",{className:"participant-detail-view",children:[(0,P.jsxs)("div",{className:"detail-header",children:[(0,P.jsxs)("button",{className:"btn btn-outline",onClick:n,children:[(0,P.jsx)(O,{name:"user",size:"small"})," Back to Participants"]}),(0,P.jsxs)("div",{className:"participant-info",children:[(0,P.jsxs)("h2",{children:["Participant: ",s.candidateName||"Unknown"]}),(0,P.jsxs)("p",{children:["Test: ",t.title]})]})]}),(0,P.jsxs)("div",{className:"detail-tabs",children:[(0,P.jsx)("button",{className:"tab ".concat("overview"===l?"active":""),onClick:()=>o("overview"),children:"Overview"}),(0,P.jsxs)("button",{className:"tab ".concat("tabswitches"===l?"active":""),onClick:()=>o("tabswitches"),children:["Tab Switches (",m.length,")"]}),(0,P.jsxs)("button",{className:"tab ".concat("copy"===l?"active":""),onClick:()=>o("copy"),children:["Copy Events (",p.length,")"]}),(0,P.jsxs)("button",{className:"tab ".concat("paste"===l?"active":""),onClick:()=>o("paste"),children:["Paste Events (",v.length,")"]}),(0,P.jsxs)("button",{className:"tab ".concat("violations"===l?"active":""),onClick:()=>o("violations"),children:["All Violations (",i.length,")"]})]}),(0,P.jsxs)("div",{className:"detail-content",children:["overview"===l&&(0,P.jsx)("div",{className:"overview-tab",children:(0,P.jsx)("div",{className:"activity-summary",children:(0,P.jsxs)("div",{className:"summary-card",children:[(0,P.jsx)("h3",{children:"Activity Summary"}),(0,P.jsxs)("div",{className:"summary-stats",children:[(0,P.jsxs)("div",{className:"stat-item",children:[(0,P.jsx)("span",{className:"stat-label",children:"Tab Switches:"}),(0,P.jsx)("span",{className:"stat-value",children:m.length})]}),(0,P.jsxs)("div",{className:"stat-item",children:[(0,P.jsx)("span",{className:"stat-label",children:"Copy Events:"}),(0,P.jsx)("span",{className:"stat-value",children:p.length})]}),(0,P.jsxs)("div",{className:"stat-item",children:[(0,P.jsx)("span",{className:"stat-label",children:"Paste Events:"}),(0,P.jsx)("span",{className:"stat-value",children:v.length})]}),(0,P.jsxs)("div",{className:"stat-item",children:[(0,P.jsx)("span",{className:"stat-label",children:"Total Violations:"}),(0,P.jsx)("span",{className:"stat-value",children:i.length})]}),(0,P.jsxs)("div",{className:"stat-item",children:[(0,P.jsx)("span",{className:"stat-label",children:"Keyboard Shortcuts:"}),(0,P.jsx)("span",{className:"stat-value",children:g.length})]}),(0,P.jsxs)("div",{className:"stat-item",children:[(0,P.jsx)("span",{className:"stat-label",children:"Right Clicks:"}),(0,P.jsx)("span",{className:"stat-value",children:b.length})]}),(0,P.jsxs)("div",{className:"stat-item",children:[(0,P.jsx)("span",{className:"stat-label",children:"Status:"}),(0,P.jsx)("span",{className:"badge ".concat("blocked"===s.status||s.blocked?"badge-error":"in_progress"===s.status||"active"===s.status?"badge-success":"badge-neutral"),children:"blocked"===s.status||s.blocked?"Blocked":"in_progress"===s.status?"In Progress":"active"===s.status?"Active":"completed"===s.status?"Completed":"Unknown"})]}),(0,P.jsxs)("div",{className:"stat-item",children:[(0,P.jsx)("span",{className:"stat-label",children:"Risk Level:"}),(0,P.jsx)("span",{className:"badge ".concat(i.length>5?"badge-error":i.length>2?"badge-warning":"badge-success"),children:i.length>5?"\ud83d\udd34 High Risk":i.length>2?"\ud83d\udfe1 Medium Risk":"\ud83d\udfe2 Low Risk"})]})]})]})})}),"tabswitches"===l&&(0,P.jsxs)("div",{className:"tabswitches-tab",children:[(0,P.jsx)("h3",{children:"Tab Switch & Focus Events"}),0===m.length?(0,P.jsx)("div",{className:"no-events",children:(0,P.jsx)("p",{children:"\u2705 No tab switch events recorded - Good behavior!"})}):(0,P.jsx)("div",{className:"events-list",children:m.map((e,s)=>(0,P.jsxs)("div",{className:"event-item violation-event",children:[(0,P.jsxs)("div",{className:"event-header",children:[(0,P.jsx)("span",{className:"event-time",children:x(e.timestamp)}),(0,P.jsx)("span",{className:"event-type",children:"tab_switch"===e.type?"\ud83d\udd04 Tab Switch":"visibility_change"===e.type?"\ud83d\udc41\ufe0f Window Hidden":"\ud83c\udfaf Focus Lost"})]}),(0,P.jsxs)("div",{className:"event-details",children:[(0,P.jsx)("span",{className:"event-description",children:"tab_switch"===e.type?"Switched to another tab/window":"visibility_change"===e.type?"Test window was hidden or minimized":"Lost focus from the test interface"}),e.duration&&(0,P.jsxs)("span",{className:"event-duration",children:["Duration: ",Math.round(e.duration/1e3),"s"]})]})]},s))})]}),"copy"===l&&(0,P.jsxs)("div",{className:"copy-tab",children:[(0,P.jsx)("h3",{children:"Copy Events"}),0===p.length?(0,P.jsx)("div",{className:"no-events",children:(0,P.jsx)("p",{children:"\u2705 No copy events recorded - Good behavior!"})}):(0,P.jsx)("div",{className:"events-list",children:p.map((e,s)=>(0,P.jsxs)("div",{className:"event-item violation-event",children:[(0,P.jsxs)("div",{className:"event-header",children:[(0,P.jsx)("span",{className:"event-time",children:x(e.timestamp)}),(0,P.jsx)("span",{className:"event-type",children:"\ud83d\udccb Copy Event"})]}),(0,P.jsxs)("div",{className:"event-content",children:[(0,P.jsxs)("span",{className:"event-description",children:["Content copied from ",e.source||"unknown source",":"]}),(0,P.jsx)("pre",{className:"copied-content",children:e.content||e.data||"Content not recorded"}),e.questionId&&(0,P.jsxs)("span",{className:"event-context",children:["From Question: ",X(e.questionId,c,e.questionText)]})]})]},s))})]}),"paste"===l&&(0,P.jsxs)("div",{className:"paste-tab",children:[(0,P.jsx)("h3",{children:"Paste Events"}),0===v.length?(0,P.jsx)("div",{className:"no-events",children:(0,P.jsx)("p",{children:"\u2705 No paste events recorded - Good behavior!"})}):(0,P.jsx)("div",{className:"events-list",children:v.map((e,s)=>(0,P.jsxs)("div",{className:"event-item violation-event",children:[(0,P.jsxs)("div",{className:"event-header",children:[(0,P.jsx)("span",{className:"event-time",children:x(e.timestamp)}),(0,P.jsx)("span",{className:"event-type",children:"\ud83d\udccc Paste Event"})]}),(0,P.jsxs)("div",{className:"event-content",children:[(0,P.jsxs)("span",{className:"event-description",children:["Content pasted into ",e.field||e.target||"answer field",":"]}),(0,P.jsx)("pre",{className:"pasted-content",children:e.content||e.data||"Content not recorded"}),e.questionId&&(0,P.jsxs)("span",{className:"event-context",children:["Into Question: ",X(e.questionId,c,e.questionText)]})]})]},s))})]}),"violations"===l&&(0,P.jsxs)("div",{className:"violations-tab",children:[(0,P.jsx)("h3",{children:"All Security Violations"}),0===i.length?(0,P.jsx)("div",{className:"no-events",children:(0,P.jsx)("p",{children:"\u2705 No violations recorded - Excellent behavior!"})}):(0,P.jsx)("div",{className:"events-list",children:i.map((e,s)=>(0,P.jsxs)("div",{className:"event-item violation-event",children:[(0,P.jsxs)("div",{className:"event-header",children:[(0,P.jsx)("span",{className:"event-time",children:x(e.timestamp)}),(0,P.jsx)("span",{className:"event-type",children:"tab_switch"===e.type?"\ud83d\udd04 Tab Switch":"copy"===e.type?"\ud83d\udccb Copy":"paste"===e.type?"\ud83d\udccc Paste":"keyboard_shortcut"===e.type?"\u2328\ufe0f Shortcut":"right_click"===e.type?"\ud83d\uddb1\ufe0f Right Click":"fullscreen_exit"===e.type?"\ud83d\udcfa Fullscreen Exit":"visibility_change"===e.type?"\ud83d\udc41\ufe0f Window Hidden":"\u26a0\ufe0f ".concat(e.type)})]}),(0,P.jsxs)("div",{className:"event-content",children:[(0,P.jsx)("span",{className:"event-description",children:e.description||("tab_switch"===e.type?"Switched away from test":"copy"===e.type?"Copied content":"paste"===e.type?"Pasted content":"keyboard_shortcut"===e.type?"Used shortcut: ".concat(e.shortcut||"Unknown"):"right_click"===e.type?"Right-clicked on page":"fullscreen_exit"===e.type?"Exited fullscreen mode":"Security violation detected")}),(e.content||e.data)&&(0,P.jsx)("pre",{className:"event-data",children:e.content||e.data}),e.questionId&&(0,P.jsxs)("span",{className:"event-context",children:["Question: ",X(e.questionId,c,e.questionText)]})]})]},s))})]})]})]})}const ee=function(){const e=(0,i.Zp)(),[s,t]=(0,a.useState)("overview"),{loading:l}=(0,n.D)(),o=(0,a.useMemo)(()=>[{label:"Overview",value:"overview"},{label:"Users",value:"users"},{label:"Tests",value:"tests"},{label:"Monitoring",value:"monitoring"},{label:"Leaderboard",value:"leaderboard"}],[]);return l?(0,P.jsx)(c.A,{message:"Loading admin dashboard",subtext:"Please wait while we prepare your admin workspace"}):(0,P.jsxs)("div",{className:"admin-dashboard theme-admin",children:[(0,P.jsx)("div",{className:"dashboard-header",children:(0,P.jsxs)("div",{className:"header-content",children:[(0,P.jsxs)("div",{className:"user-info",children:[(0,P.jsx)("h1",{children:"Admin Dashboard"}),(0,P.jsx)("span",{className:"badge badge-admin",children:"Administrator"})]}),(0,P.jsx)("button",{className:"btn btn-outline",onClick:async()=>{try{await(0,r.CI)(h.j2),e("/")}catch(s){console.error("Sign out error:",s)}},children:"Sign Out"})]})}),(0,P.jsxs)("div",{className:"dashboard-content",children:[(0,P.jsx)("div",{className:"dashboard-nav",children:(0,P.jsx)("div",{className:"tc-tabs",children:o.map(e=>(0,P.jsx)("button",{className:"tc-tab ".concat(s===e.value?"is-active":""),onClick:()=>t(e.value),"data-tab":e.value,children:e.label},e.value))})}),(0,P.jsxs)("div",{className:"dashboard-main",children:["overview"===s&&(0,P.jsx)(H,{}),"users"===s&&(0,P.jsx)(_,{}),"tests"===s&&(0,P.jsx)(Y,{}),"monitoring"===s&&(0,P.jsx)(K,{}),"leaderboard"===s&&(0,P.jsx)(Q,{})]})]})]})};var se=t(372);const te=(e,s)=>0===e?"".concat(s," min"):0===s?"".concat(e,"h"):"".concat(e,"h ").concat(s,"min");function ae(){const[e,s]=(0,a.useState)(1),[t,i]=(0,a.useState)({title:"",description:"",durationHours:0,durationMinutes:30,branch:"DSA",password:"",totalMarks:0,allowMultipleSubmissions:!1}),[l,o]=(0,a.useState)([]),[c,r]=(0,a.useState)(0),[m,x]=(0,a.useState)(!1),[p,v]=(0,a.useState)(""),[g,b]=(0,a.useState)(""),{userDoc:j}=(0,n.D)();(0,a.useEffect)(()=>{null!==j&&void 0!==j&&j.domain&&i(e=>(0,d.A)((0,d.A)({},e),{},{branch:j.domain}))},[null===j||void 0===j?void 0:j.domain]);const N=(e,s,t)=>{o(l.map(a=>a.id===e?(0,d.A)((0,d.A)({},a),{},{[s]:t}):a))};return(0,P.jsxs)("div",{className:"head-create-test",children:[(0,P.jsxs)("div",{className:"create-test-header",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("h3",{children:"Create New Test"}),(0,P.jsx)("p",{children:"Design and configure your test questions"})]}),(0,P.jsxs)("div",{className:"branch-badge",children:[(0,P.jsx)("span",{children:"Domain:"}),(0,P.jsx)("span",{className:"badge badge-primary",children:(null===j||void 0===j?void 0:j.domain)||"Full Stack"})]})]}),(0,P.jsxs)("div",{className:"create-test-content",children:[p&&(0,P.jsx)("div",{className:"alert alert-error",children:p}),g&&(0,P.jsx)("div",{className:"alert alert-success",children:g}),1===e&&(0,P.jsxs)("div",{className:"test-details-form",children:[(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Test Title *"}),(0,P.jsx)("input",{type:"text",className:"form-input",placeholder:"e.g., JavaScript Fundamentals Assessment",value:t.title,onChange:e=>i((0,d.A)((0,d.A)({},t),{},{title:e.target.value}))}),(0,P.jsx)("div",{className:"form-help",children:"Choose a clear, descriptive title for your test"})]}),(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Description"}),(0,P.jsx)("textarea",{className:"form-input",placeholder:"Describe what this test covers and any special instructions for candidates...",rows:4,value:t.description,onChange:e=>i((0,d.A)((0,d.A)({},t),{},{description:e.target.value}))}),(0,P.jsx)("div",{className:"form-help",children:"Optional: Provide context and instructions for candidates"})]}),(0,P.jsxs)("div",{className:"form-row",children:[(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Test Duration"}),(0,P.jsxs)("div",{className:"duration-inputs",style:{display:"flex",gap:"12px",alignItems:"center"},children:[(0,P.jsxs)("div",{style:{display:"flex",flexDirection:"column",flex:1},children:[(0,P.jsx)("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",min:"0",max:"12",className:"form-input",value:t.durationHours,onChange:e=>{const s=e.target.value.replace(/[^0-9]/g,""),a=parseInt(s)||0;a<=12&&i((0,d.A)((0,d.A)({},t),{},{durationHours:a}))},placeholder:"0"}),(0,P.jsx)("small",{style:{color:"#6b7280",fontSize:"12px",marginTop:"4px"},children:"Hours"})]}),(0,P.jsx)("span",{style:{color:"#6b7280",fontWeight:"bold"},children:":"}),(0,P.jsxs)("div",{style:{display:"flex",flexDirection:"column",flex:1},children:[(0,P.jsx)("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",min:"0",max:"59",className:"form-input",value:t.durationMinutes,onChange:e=>{const s=e.target.value.replace(/[^0-9]/g,""),a=parseInt(s)||0;a<=59&&i((0,d.A)((0,d.A)({},t),{},{durationMinutes:a}))},placeholder:"30"}),(0,P.jsx)("small",{style:{color:"#6b7280",fontSize:"12px",marginTop:"4px"},children:"Minutes"})]})]}),(0,P.jsxs)("div",{className:"form-help",children:["Set the time limit for completing the test. Total: ",te(t.durationHours,t.durationMinutes)]})]}),(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Domain"}),(0,P.jsx)("input",{type:"text",className:"form-input readonly",value:t.branch,readOnly:!0,title:"Domain is assigned by admin and cannot be changed"}),(0,P.jsx)("div",{className:"form-help",children:"Domain is assigned by admin and cannot be modified"})]})]}),(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Test Password *"}),(0,P.jsx)("input",{type:"password",className:"form-input",placeholder:"Enter a secure password for test access",value:t.password,onChange:e=>i((0,d.A)((0,d.A)({},t),{},{password:e.target.value}))}),(0,P.jsx)("div",{className:"form-help",children:"Candidates will need this password to access the test"})]}),(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Multiple Submissions"}),(0,P.jsxs)("div",{className:"toggle-container",style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,P.jsxs)("label",{className:"toggle-switch",style:{position:"relative",display:"inline-block",width:"50px",height:"24px"},children:[(0,P.jsx)("input",{type:"checkbox",checked:t.allowMultipleSubmissions,onChange:e=>i((0,d.A)((0,d.A)({},t),{},{allowMultipleSubmissions:e.target.checked})),style:{opacity:0,width:0,height:0}}),(0,P.jsx)("span",{className:"toggle-slider",style:{position:"absolute",cursor:"pointer",top:0,left:0,right:0,bottom:0,backgroundColor:t.allowMultipleSubmissions?"#4CAF50":"#ccc",transition:"0.4s",borderRadius:"24px"},children:(0,P.jsx)("span",{style:{position:"absolute",content:"",height:"18px",width:"18px",left:t.allowMultipleSubmissions?"26px":"3px",bottom:"3px",backgroundColor:"white",transition:"0.4s",borderRadius:"50%"}})})]}),(0,P.jsx)("span",{style:{fontSize:"14px",color:t.allowMultipleSubmissions?"#4CAF50":"#666"},children:t.allowMultipleSubmissions?"Enabled":"Disabled"})]}),(0,P.jsx)("div",{className:"form-help",children:t.allowMultipleSubmissions?"Candidates can submit multiple times. Only the latest submission will be considered for grading.":"Candidates can submit only once. Choose this for final exams or assessments."})]}),(0,P.jsx)("div",{className:"form-actions",children:(0,P.jsx)("button",{className:"btn btn-primary",onClick:()=>s(2),disabled:!t.title||!t.password,children:"Next: Add Questions \u2192"})})]}),2===e&&(0,P.jsxs)("div",{className:"questions-form",children:[(0,P.jsxs)("div",{className:"questions-header",children:[(0,P.jsxs)("div",{children:[(0,P.jsxs)("h4",{children:["Question ",l.length?c+1:0," of ",l.length]}),(0,P.jsx)("p",{children:"Add and configure your test questions"})]}),(0,P.jsxs)("div",{className:"question-actions",children:[(0,P.jsx)("button",{className:"btn btn-outline btn-sm",onClick:()=>{const e=[...l,{id:Date.now(),questionText:"",questionType:"mcq",options:["","","",""],correctAnswer:"",marks:1,imageUrl:""}];o(e),r(e.length-1)},children:"+ Add Question"}),l.length>0&&(0,P.jsx)("button",{className:"btn btn-outline btn-sm btn-danger",onClick:()=>(e=>{const s=l.findIndex(s=>s.id===e),t=l.filter(s=>s.id!==e);o(t),0===t.length?r(0):s>=t.length&&r(t.length-1)})(l[c].id),children:"Remove"})]})]}),0===l.length?(0,P.jsxs)("div",{className:"no-questions",children:[(0,P.jsx)("div",{children:"No questions added yet"}),(0,P.jsx)("div",{children:'Click "Add Question" to start creating your test questions'})]}):(0,P.jsxs)("div",{className:"question-editor",children:[(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Question Text *"}),(0,P.jsx)("textarea",{className:"form-input",placeholder:"Enter your question here...",rows:4,value:l[c].questionText,onChange:e=>N(l[c].id,"questionText",e.target.value)}),(0,P.jsx)("div",{className:"form-help",children:"Write a clear and specific question"})]}),(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Question Image (Optional)"}),(0,P.jsxs)("div",{className:"image-upload-section",children:[(0,P.jsx)("input",{type:"url",className:"form-input",placeholder:"Enter image URL (e.g., https://example.com/image.jpg)",value:l[c].imageUrl||"",onChange:e=>N(l[c].id,"imageUrl",e.target.value)}),(0,P.jsx)("div",{className:"image-upload-help",children:(0,P.jsx)("span",{className:"help-text",children:"\ud83d\udca1 Add an image URL to provide visual illustration for your question"})}),l[c].imageUrl&&(0,P.jsxs)("div",{className:"image-preview",children:[(0,P.jsx)("img",{src:l[c].imageUrl,alt:"Question illustration",onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="block"},onLoad:e=>{e.target.style.display="block",e.target.nextSibling.style.display="none"}}),(0,P.jsx)("div",{className:"image-error",style:{display:"none"},children:"\u274c Failed to load image. Please check the URL."}),(0,P.jsx)("button",{type:"button",className:"btn btn-outline btn-sm remove-image",onClick:()=>N(l[c].id,"imageUrl",""),children:"Remove Image"})]})]})]}),(0,P.jsxs)("div",{className:"form-row",children:[(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Question Type"}),(0,P.jsxs)("select",{className:"form-input",value:l[c].questionType,onChange:e=>N(l[c].id,"questionType",e.target.value),children:[(0,P.jsx)("option",{value:"mcq",children:"Multiple Choice (MCQ)"}),(0,P.jsx)("option",{value:"long",children:"Long Answer"}),(0,P.jsx)("option",{value:"code",children:"Code"})]}),(0,P.jsx)("div",{className:"form-help",children:"Choose the type of question"})]}),(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Marks"}),(0,P.jsx)("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",className:"form-input",min:"1",max:"100",value:l[c].marks,onChange:e=>{const s=e.target.value.replace(/[^0-9]/g,""),t=parseInt(s)||1;t>=1&&t<=100&&N(l[c].id,"marks",t)}}),(0,P.jsx)("div",{className:"form-help",children:"Points awarded for correct answer"})]})]}),"mcq"===l[c].questionType&&(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Answer Options"}),(0,P.jsx)("div",{className:"mcq-options",children:l[c].options.map((e,s)=>(0,P.jsxs)("div",{className:"mcq-option",children:[(0,P.jsx)("input",{type:"radio",name:"correct-".concat(l[c].id),checked:l[c].correctAnswer===e,onChange:()=>N(l[c].id,"correctAnswer",e)}),(0,P.jsx)("input",{type:"text",className:"form-input",placeholder:"Option ".concat(s+1),value:e,onChange:e=>{const t=[...l[c].options];t[s]=e.target.value,N(l[c].id,"options",t)}})]},s))}),(0,P.jsx)("div",{className:"form-help",children:"Select the correct answer by clicking the radio button"})]}),("long"===l[c].questionType||"code"===l[c].questionType)&&(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Expected Answer / Sample Solution"}),(0,P.jsx)("textarea",{className:"form-input",placeholder:"code"===l[c].questionType?"Enter the expected code solution or key points...":"Enter the expected answer or key points to look for...",rows:4,value:l[c].correctAnswer,onChange:e=>N(l[c].id,"correctAnswer",e.target.value)}),(0,P.jsx)("div",{className:"form-help",children:"code"===l[c].questionType?"Provide the expected code solution or key implementation details":"Provide the expected answer or key points for evaluation"})]})]}),(0,P.jsxs)("div",{className:"questions-footer",children:[(0,P.jsx)("button",{className:"btn btn-outline",onClick:()=>s(1),children:"\u2190 Back to Test Details"}),(0,P.jsxs)("div",{className:"question-nav",children:[(0,P.jsx)("button",{className:"btn btn-outline btn-sm",onClick:()=>r(e=>Math.max(0,e-1)),disabled:c<=0,children:"\u2190 Previous"}),(0,P.jsx)("button",{className:"btn btn-outline btn-sm",onClick:()=>r(e=>Math.min(l.length-1,e+1)),disabled:c>=l.length-1,children:"Next \u2192"}),(0,P.jsx)("button",{className:"btn btn-primary btn-lg ".concat(m?"btn-loading":""),onClick:async()=>{x(!0),v("");try{var e,a,n;if(console.log("[Head:createTest] Starting test creation..."),console.log("Questions with images:",l.map(e=>({id:e.id,questionText:e.questionText.substring(0,50)+"...",imageUrl:e.imageUrl}))),!t.title||""===t.title.trim())return void v("Test title is required");if(!t.branch||""===t.branch.trim())return void v("Test branch is required");if(0===l.length)return void v("At least one question is required");const c=(0,u.doc)((0,u.collection)(h.db,"tests")),d=c.id,r={testId:d,title:t.title.trim(),description:(null===(e=t.description)||void 0===e?void 0:e.trim())||"No description",duration:te(t.durationHours,t.durationMinutes),branch:t.branch.trim(),password:(null===(a=t.password)||void 0===a?void 0:a.trim())||"test123",totalMarks:l.reduce((e,s)=>e+(s.marks||1),0),allowMultipleSubmissions:t.allowMultipleSubmissions||!1,status:"active",createdBy:(null===(n=h.j2.currentUser)||void 0===n?void 0:n.uid)||"unknown",createdAt:(0,u.serverTimestamp)(),scheduledFor:(0,u.serverTimestamp)()};await(0,u.setDoc)(c,r),console.log("[Head:createTest] Test document saved successfully with ID:",d);for(const e of l){const s={questionId:e.id.toString(),questionText:e.questionText||"No question text",questionType:e.questionType||"mcq",options:"mcq"===e.questionType?e.options||["","","",""]:[],correctAnswer:e.correctAnswer||"",marks:e.marks||1,imageUrl:e.imageUrl||""};console.log("Saving question with imageUrl:",s.imageUrl),await(0,u.addDoc)((0,u.collection)(h.db,"tests",d,"questions"),s)}b("Test created successfully!"),s(1),i({title:"",description:"",durationHours:0,durationMinutes:30,branch:"Full Stack",password:"",totalMarks:0,allowMultipleSubmissions:!1}),o([])}catch(c){console.log("[Head:createTest:error]",c.code,c.message),v(c.message||"Failed to create test")}finally{x(!1)}},disabled:0===l.length||m,children:m?"Creating Test...":"Create Test (".concat(l.reduce((e,s)=>e+s.marks,0)," marks)")})]})]})]})]})]})}function ie(){var e;const[s,t]=(0,a.useState)([]),[i,l]=(0,a.useState)(!1),[o,r]=(0,a.useState)(""),[m,x]=(0,a.useState)(null),[p,v]=(0,a.useState)(1),[g,b]=(0,a.useState)({title:"",description:"",duration:"30 min",durationHours:0,durationMinutes:30,password:"",allowMultipleSubmissions:!1}),[j,N]=(0,a.useState)([]),[f,y]=(0,a.useState)(0),[w,k]=(0,a.useState)(!1),{userDoc:A}=(0,n.D)();(0,a.useEffect)(()=>{null!==A&&void 0!==A&&A.domain&&(async()=>{l(!0),r("");try{const e=(0,u.collection)(h.db,"tests"),s=(0,u.query)(e,(0,u.where)("branch","==",(null===A||void 0===A?void 0:A.domain)||"Full Stack")),a=(await(0,u.getDocs)(s)).docs.map(e=>(0,d.A)({id:e.id},e.data()));t(a)}catch(e){console.log("[Head:loadTests:error]",e.code,e.message),r(e.message||"Failed to load tests")}finally{l(!1)}})()},[null===A||void 0===A?void 0:A.domain]);const S=async e=>{try{console.log("=== MANUAL DATABASE CHECK ===");const s=(0,u.collection)(h.db,"tests",e,"questions"),t=await(0,u.getDocs)(s);console.log("Number of questions in database:",t.docs.length),t.docs.forEach((e,s)=>{var t;const a=e.data();console.log("Question ".concat(s+1,":"),{docId:e.id,questionId:a.questionId,questionText:(null===(t=a.questionText)||void 0===t?void 0:t.substring(0,30))+"...",imageUrl:a.imageUrl,fullData:a})}),console.log("=== END DATABASE CHECK ===")}catch(o){console.error("Database check error:",o)}},q=async e=>{try{k(!0),console.log("Starting edit for test:",e),await S(e.id);const s=await(0,se.Ml)(e.id);if(console.log("Fetched test data:",s),console.log("Questions from database:",null===s||void 0===s?void 0:s.questions),null!==s&&void 0!==s&&s.questions&&console.log("Questions with imageUrl:",s.questions.map(e=>{var s;return{id:e.id,questionText:(null===(s=e.questionText)||void 0===s?void 0:s.substring(0,30))+"...",imageUrl:e.imageUrl}})),s){x(e);const t=(e=>{if(!e)return{hours:0,minutes:30};const s=e.match(/(\d+)\s*min/),t=e.match(/(\d+)h/);let a=0;if(t&&(a+=60*parseInt(t[1])),s&&(a+=parseInt(s[1])),!t&&!s){const s=e.match(/(\d+)/);s&&(a=parseInt(s[1]))}return{hours:Math.floor(a/60),minutes:a%60}})(s.duration||"30 min");b({title:s.title||"",description:s.description||"",duration:s.duration||"30 min",durationHours:t.hours,durationMinutes:t.minutes,password:s.password||"",allowMultipleSubmissions:s.allowMultipleSubmissions||!1});const a=(s.questions||[]).map(e=>({id:e.id||e.questionId||Date.now(),questionText:e.questionText||"",questionType:e.questionType||"mcq",options:e.options||["","","",""],correctAnswer:e.correctAnswer||"",marks:e.marks||1,imageUrl:e.imageUrl||""}));console.log("Processed questions for editing:",a),N(a),y(0),v(1),console.log("Edit modal should now show with step:",1)}}catch(s){console.log("[Head:startEdit:error]",s),r("Failed to load test for editing")}finally{k(!1)}};return(0,P.jsxs)("div",{className:"head-manage-tests",children:[(0,P.jsxs)("div",{className:"manage-header",children:[(0,P.jsx)("h3",{children:"Manage Tests"}),(0,P.jsxs)("div",{className:"branch-badge",children:[(0,P.jsx)("span",{children:"Domain:"}),(0,P.jsx)("span",{className:"badge badge-primary",children:(null===A||void 0===A?void 0:A.domain)||"Full Stack"})]})]}),o&&(0,P.jsx)("div",{className:"alert alert-error",children:o}),i?(0,P.jsx)("div",{className:"loading-tests",children:(0,P.jsx)(c.A,{message:"Loading tests",subtext:"Fetching your created tests",variant:"inline",size:"large"})}):0===s.length?(0,P.jsx)("div",{className:"no-tests",children:"No tests created yet."}):(0,P.jsx)("div",{className:"tests-grid",children:s.map(e=>{var a,i,n;return(0,P.jsxs)("div",{className:"test-card",children:[(0,P.jsxs)("div",{className:"test-info",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("h4",{children:e.title}),(0,P.jsxs)("div",{className:"test-meta",children:[e.branch," \u2022 ",e.duration," \u2022 ",e.totalMarks," marks"]}),(0,P.jsxs)("div",{className:"test-details",children:[(0,P.jsxs)("span",{children:["Created: ",(null===(a=e.createdAt)||void 0===a||null===(i=a.toDate)||void 0===i||null===(n=i.call(a))||void 0===n?void 0:n.toLocaleDateString())||"Unknown"]}),(0,P.jsxs)("span",{className:"password-display",children:["Password: ",e.password||"No password"]})]})]}),(0,P.jsx)("span",{className:"badge ".concat("active"===e.status?"badge-success":"badge-neutral"),children:e.status})]}),(0,P.jsxs)("div",{className:"test-actions",children:[(0,P.jsx)("button",{className:"btn btn-outline btn-sm ".concat(w?"btn-loading":""),onClick:()=>q(e),disabled:w,children:w?"Loading...":"Edit"}),(0,P.jsx)("button",{className:"btn btn-outline btn-sm",onClick:()=>(async(e,a)=>{try{const i="active"===a?"closed":"active";await(0,u.updateDoc)((0,u.doc)(h.db,"tests",e),{status:i}),t(s.map(s=>s.id===e?(0,d.A)((0,d.A)({},s),{},{status:i}):s))}catch(i){console.log("[Head:toggleStatus:error]",i.code,i.message),r(i.message||"Failed to update test status")}})(e.id,e.status),children:"active"===e.status?"Close":"Activate"}),(0,P.jsx)("button",{className:"btn btn-outline btn-sm",onClick:()=>S(e.id),style:{fontSize:"10px",padding:"2px 6px"},children:"\ud83d\udd0d Debug DB"})]})]},e.id)})}),m&&(0,P.jsx)("div",{className:"edit-modal-overlay",children:(0,P.jsxs)("div",{className:"edit-modal",children:[(0,P.jsxs)("div",{className:"modal-header",children:[(0,P.jsxs)("h3",{children:["Edit Test: ",m.title]}),(0,P.jsx)("button",{className:"modal-close",onClick:()=>x(null),children:"\xd7"})]}),(0,P.jsxs)("div",{className:"modal-body",children:[console.log("Rendering modal body. editStep:",p,"editingTest:",m),1===p&&(0,P.jsxs)("div",{className:"edit-step-1",children:[(0,P.jsx)("h4",{children:"Test Information"}),(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Test Title"}),(0,P.jsx)("input",{type:"text",value:g.title,onChange:e=>b((0,d.A)((0,d.A)({},g),{},{title:e.target.value})),className:"form-input"})]}),(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Description"}),(0,P.jsx)("textarea",{value:g.description,onChange:e=>b((0,d.A)((0,d.A)({},g),{},{description:e.target.value})),className:"form-textarea",rows:"3"})]}),(0,P.jsxs)("div",{className:"form-row",children:[(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Duration"}),(0,P.jsxs)("div",{className:"duration-inputs",style:{display:"flex",gap:"12px",alignItems:"center"},children:[(0,P.jsxs)("div",{style:{display:"flex",flexDirection:"column",flex:1},children:[(0,P.jsx)("input",{type:"number",min:"0",max:"12",className:"form-input",value:g.durationHours,onChange:e=>b((0,d.A)((0,d.A)({},g),{},{durationHours:parseInt(e.target.value)||0})),placeholder:"0"}),(0,P.jsx)("small",{style:{color:"#6b7280",fontSize:"12px",marginTop:"4px"},children:"Hours"})]}),(0,P.jsx)("span",{style:{color:"#6b7280",fontWeight:"bold"},children:":"}),(0,P.jsxs)("div",{style:{display:"flex",flexDirection:"column",flex:1},children:[(0,P.jsx)("input",{type:"number",min:"0",max:"59",step:"1",className:"form-input",value:g.durationMinutes,onChange:e=>b((0,d.A)((0,d.A)({},g),{},{durationMinutes:parseInt(e.target.value)||0})),placeholder:"30"}),(0,P.jsx)("small",{style:{color:"#6b7280",fontSize:"12px",marginTop:"4px"},children:"Minutes"})]})]}),(0,P.jsxs)("div",{className:"form-help",children:["Total: ",te(g.durationHours,g.durationMinutes)]})]}),(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Password"}),(0,P.jsx)("input",{type:"text",value:g.password,onChange:e=>b((0,d.A)((0,d.A)({},g),{},{password:e.target.value})),className:"form-input",placeholder:"Optional test password"})]})]}),(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Multiple Submissions"}),(0,P.jsxs)("div",{className:"toggle-container",style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,P.jsxs)("label",{className:"toggle-switch",style:{position:"relative",display:"inline-block",width:"50px",height:"24px"},children:[(0,P.jsx)("input",{type:"checkbox",checked:g.allowMultipleSubmissions,onChange:e=>b((0,d.A)((0,d.A)({},g),{},{allowMultipleSubmissions:e.target.checked})),style:{opacity:0,width:0,height:0}}),(0,P.jsx)("span",{className:"toggle-slider",style:{position:"absolute",cursor:"pointer",top:0,left:0,right:0,bottom:0,backgroundColor:g.allowMultipleSubmissions?"#4CAF50":"#ccc",transition:"0.4s",borderRadius:"24px"},children:(0,P.jsx)("span",{style:{position:"absolute",content:"",height:"18px",width:"18px",left:g.allowMultipleSubmissions?"26px":"3px",bottom:"3px",backgroundColor:"white",transition:"0.4s",borderRadius:"50%"}})})]}),(0,P.jsx)("span",{style:{fontSize:"14px",color:g.allowMultipleSubmissions?"#4CAF50":"#666"},children:g.allowMultipleSubmissions?"Enabled":"Disabled"})]}),(0,P.jsx)("div",{className:"form-help",children:g.allowMultipleSubmissions?"Candidates can submit multiple times. Only the latest submission will be considered for grading.":"Candidates can submit only once. Choose this for final exams or assessments."})]}),(0,P.jsx)("div",{className:"modal-actions",children:(0,P.jsx)("button",{className:"btn btn-primary",onClick:()=>v(2),disabled:!g.title.trim(),children:"Next: Edit Questions"})})]}),2===p&&(0,P.jsxs)("div",{className:"edit-step-2",children:[(0,P.jsxs)("div",{className:"questions-header",children:[(0,P.jsxs)("h4",{children:["Questions (",j.length,")"]}),(0,P.jsx)("button",{className:"btn btn-outline btn-sm",onClick:()=>{const e={id:Date.now(),questionText:"",questionType:"mcq",options:["","","",""],correctAnswer:"",marks:1,imageUrl:""};N([...j,e]),y(j.length)},children:"+ Add Question"})]}),j.length>0&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)("div",{className:"question-nav",children:[(0,P.jsx)("button",{className:"btn btn-outline btn-sm",onClick:()=>y(Math.max(0,f-1)),disabled:0===f,children:"\u2190 Previous"}),(0,P.jsxs)("span",{children:["Question ",f+1," of ",j.length]}),(0,P.jsx)("button",{className:"btn btn-outline btn-sm",onClick:()=>y(Math.min(j.length-1,f+1)),disabled:f>=j.length-1,children:"Next \u2192"})]}),j[f]&&(0,P.jsxs)("div",{className:"question-editor",children:[(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Question Text"}),(0,P.jsx)("textarea",{value:j[f].questionText,onChange:e=>{const s=[...j];s[f].questionText=e.target.value,N(s)},className:"form-textarea",rows:"4",placeholder:"Enter your question..."})]}),(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Question Image (Optional)"}),(0,P.jsxs)("div",{className:"image-upload-section",children:[(0,P.jsx)("input",{type:"url",value:(null===(e=j[f])||void 0===e?void 0:e.imageUrl)||"",onChange:e=>{const s=[...j];s[f].imageUrl=e.target.value,N(s),console.log("Image URL updated:",e.target.value)},className:"form-input",placeholder:"Enter image URL (e.g., https://example.com/image.jpg)"}),(0,P.jsx)("div",{className:"image-upload-help",children:(0,P.jsx)("span",{className:"help-text",children:"\ud83d\udca1 Add an image URL to provide visual illustration for your question"})}),j[f].imageUrl&&(0,P.jsxs)("div",{className:"image-preview",children:[(0,P.jsx)("img",{src:j[f].imageUrl,alt:"Question illustration",onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="block"},onLoad:e=>{e.target.style.display="block",e.target.nextSibling.style.display="none"}}),(0,P.jsx)("div",{className:"image-error",style:{display:"none"},children:"\u274c Failed to load image. Please check the URL."}),(0,P.jsx)("button",{type:"button",className:"btn btn-outline btn-sm remove-image",onClick:()=>{const e=[...j];e[f].imageUrl="",N(e)},children:"Remove Image"})]})]})]}),(0,P.jsxs)("div",{className:"form-row",children:[(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Question Type"}),(0,P.jsxs)("select",{value:j[f].questionType,onChange:e=>{const s=[...j];s[f].questionType=e.target.value,"mcq"!==e.target.value?(s[f].options=[],s[f].correctAnswer=""):s[f].options=["","","",""],N(s)},className:"form-select",children:[(0,P.jsx)("option",{value:"mcq",children:"Multiple Choice"}),(0,P.jsx)("option",{value:"long",children:"Long Answer"}),(0,P.jsx)("option",{value:"code",children:"Code"})]})]}),(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Marks"}),(0,P.jsx)("input",{type:"number",min:"1",value:j[f].marks,onChange:e=>{const s=[...j];s[f].marks=parseInt(e.target.value)||1,N(s)},className:"form-input"})]})]}),"mcq"===j[f].questionType&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Options"}),j[f].options.map((e,s)=>(0,P.jsx)("input",{type:"text",value:e,onChange:e=>{const t=[...j];t[f].options[s]=e.target.value,N(t)},className:"form-input",placeholder:"Option ".concat(s+1)},s))]}),(0,P.jsxs)("div",{className:"form-group",children:[(0,P.jsx)("label",{children:"Correct Answer"}),(0,P.jsxs)("select",{value:j[f].correctAnswer,onChange:e=>{const s=[...j];s[f].correctAnswer=e.target.value,N(s)},className:"form-select",children:[(0,P.jsx)("option",{value:"",children:"Select correct answer"}),j[f].options.map((e,s)=>e&&(0,P.jsx)("option",{value:e,children:e},s))]})]})]}),(0,P.jsx)("div",{className:"question-actions",children:(0,P.jsx)("button",{className:"btn btn-danger btn-sm",onClick:()=>{if(window.confirm("Delete this question?")){const e=j.filter((e,s)=>s!==f);N(e),f>=e.length&&y(Math.max(0,e.length-1))}},children:"Delete Question"})})]})]}),(0,P.jsxs)("div",{className:"modal-actions",children:[(0,P.jsx)("button",{className:"btn btn-outline",onClick:()=>v(1),children:"\u2190 Back to Test Info"}),(0,P.jsx)("button",{className:"btn btn-primary ".concat(w?"btn-loading":""),onClick:async()=>{try{k(!0);const e=j.reduce((e,s)=>e+(s.marks||1),0);await(0,u.updateDoc)((0,u.doc)(h.db,"tests",m.id),{title:g.title.trim(),description:g.description.trim(),duration:te(g.durationHours,g.durationMinutes),password:g.password.trim(),allowMultipleSubmissions:g.allowMultipleSubmissions,totalMarks:e,updatedAt:(0,u.serverTimestamp)()});const a=(0,u.collection)(h.db,"tests",m.id,"questions"),i=await(0,u.getDocs)(a);for(const s of i.docs)await(0,u.deleteDoc)(s.ref);for(const s of j){const e={questionId:s.id.toString(),questionText:s.questionText||"No question text",questionType:s.questionType||"mcq",options:"mcq"===s.questionType?s.options||["","","",""]:[],correctAnswer:s.correctAnswer||"",marks:s.marks||1,imageUrl:s.imageUrl||""};e.imageUrl&&console.log("Saving question with image:",e.imageUrl),await(0,u.addDoc)(a,e)}t(s.map(s=>s.id===m.id?(0,d.A)((0,d.A)((0,d.A)({},s),g),{},{totalMarks:e,allowMultipleSubmissions:g.allowMultipleSubmissions}):s)),x(null),r(""),alert("Test updated successfully!")}catch(e){console.error("Error updating test:",e),r("Failed to update test")}finally{k(!1)}},disabled:w||!g.title.trim()||0===j.length,children:w?"Saving...":"Save Changes"})]})]})]})]})})]})}function ne(){const[e,s]=(0,a.useState)([]),[t,i]=(0,a.useState)(null),[l,o]=(0,a.useState)([]),[r,m]=(0,a.useState)(null),[x,p]=(0,a.useState)(!1),[v,g]=(0,a.useState)(""),[b,N]=(0,a.useState)(!1),{userDoc:f}=(0,n.D)();(0,a.useEffect)(()=>{f?(console.log("HeadResults: User doc available, loading tests"),(async()=>{p(!0),g("");try{console.log("HeadResults: Loading tests for branch:",null===f||void 0===f?void 0:f.branch),console.log("HeadResults: User doc:",f);const e=(0,u.collection)(h.db,"tests"),t=(0,u.query)(e,(0,u.where)("branch","==",(null===f||void 0===f?void 0:f.branch)||"Full Stack"));let a=(await(0,u.getDocs)(t)).docs.map(e=>(0,d.A)({id:e.id},e.data()));console.log("HeadResults: Found tests by branch:",a.length),0===a.length&&(console.log("HeadResults: No tests found by branch, loading all tests"),a=(await(0,u.getDocs)(e)).docs.map(e=>(0,d.A)({id:e.id},e.data())),console.log("HeadResults: Found all tests:",a.length)),console.log("HeadResults: Final tests:",a),s(a)}catch(e){console.log("[Head:loadTests:error]",e.code,e.message),g(e.message||"Failed to load tests")}finally{p(!1)}})()):console.log("HeadResults: No user doc available")},[f]);const w=async e=>{p(!0),g("");try{const s=(0,u.collection)(h.db,"results"),t=(0,u.query)(s,(0,u.where)("testId","==",e)),a=await(0,u.getDocs)(t),i=await Promise.all(a.docs.map(async e=>{const s=e.data();let t=s.candidateName||"",a="";if(console.log("DEBUG: Raw candidateName from database:",s.candidateName),console.log("DEBUG: CandidateId:",s.candidateId),t&&t.includes("@"))t=t.split("@")[0],console.log("DEBUG: Extracted name from email:",t);else if(s.candidateId){console.log("DEBUG: Trying to get name from user database for:",s.candidateId);try{let a=await(0,u.getDoc)((0,u.doc)(h.db,"user",s.candidateId)),i=null;if(a.exists()?(i=a.data(),console.log('DEBUG: Found user in "user" collection:',i)):(console.log('DEBUG: No user found in "user" collection, trying "users"...'),a=await(0,u.getDoc)((0,u.doc)(h.db,"users",s.candidateId)),a.exists()&&(i=a.data(),console.log('DEBUG: Found user in "users" collection:',i))),i){const a=[i.name,i.displayName,i.fullName,i.firstName,i.username];console.log("DEBUG: Available name fields:",{name:i.name,displayName:i.displayName,fullName:i.fullName,firstName:i.firstName,username:i.username,email:i.email});for(const e of a)if(e&&e.trim()){t=e.trim(),console.log("DEBUG: Using name field:",t);break}!t&&i.email&&(t=i.email.includes("@")?i.email.split("@")[0]:i.email,console.log("DEBUG: Using email prefix from user data:",t)),t&&t!==s.candidateName&&(await(0,u.updateDoc)(e.ref,{candidateName:t}),console.log("DEBUG: Updated candidateName in database to:",t))}else console.log("DEBUG: No user found in any collection for UID:",s.candidateId),t="Candidate ".concat(s.candidateId.slice(-4))}catch(i){console.error("DEBUG: Error fetching candidate name:",i),t="Candidate ".concat(s.candidateId.slice(-4))}}return t||(t="Unknown"),a=t&&"Unknown"!==t?t:s.candidateId&&s.candidateId.includes("@")?s.candidateId.split("@")[0]:"Unknown Candidate",(0,d.A)((0,d.A)({id:e.id},s),{},{candidateName:t,displayName:a})}));o(i)}catch(s){console.log("[Head:loadSubmissions:error]",s.code,s.message),g(s.message||"Failed to load submissions")}finally{p(!1)}};return r?(0,P.jsx)(le,{submission:r,test:t,onBack:()=>m(null)}):t?(0,P.jsxs)("div",{className:"head-results",children:[(0,P.jsxs)("div",{className:"results-header",children:[(0,P.jsxs)("h3",{children:["Submissions for: ",t.title]}),(0,P.jsxs)("div",{className:"results-actions",children:[(0,P.jsxs)("div",{className:"export-actions",children:[(0,P.jsxs)("button",{className:"btn btn-outline btn-sm ".concat(b?"btn-loading":""),onClick:()=>j({submissions:l,selectedTest:t,setLoading:N}),disabled:b||0===l.length,title:"Export submissions to Excel",children:[(0,P.jsx)(O,{name:"notebook",size:"small"})," Export Excel"]}),(0,P.jsx)("button",{className:"btn btn-outline btn-sm",onClick:async()=>{var e;console.log("=== DEBUG TEST STRUCTURE ==="),console.log("Selected Test Object:",t),console.log("Selected Test ID:",t.id),console.log("Selected Test Questions:",t.questions);try{const e=await(0,u.getDoc)((0,u.doc)(h.db,"tests",t.id));if(e.exists()){const s=e.data();console.log("Firestore Test Data:",s),console.log("Available Fields:",Object.keys(s)),console.log("Questions Field:",s.questions)}else console.log("Test document not found in Firestore")}catch(v){console.error("Error fetching test:",v)}console.log("Sample Submission:",l[0]),null!==(e=l[0])&&void 0!==e&&e.answers&&console.log("Answer Keys:",Object.keys(l[0].answers)),console.log("=== END DEBUG ===")},title:"Debug Test Structure",children:"\ud83d\udd0d Debug"}),(0,P.jsxs)("button",{className:"btn btn-outline btn-sm ".concat(b?"btn-loading":""),onClick:()=>y({submissions:l,selectedTest:t,setLoading:N,exportType:"head"}),disabled:b||0===l.length,title:"Export submissions to PDF",style:{marginLeft:"8px"},children:[(0,P.jsx)(O,{name:"paper",size:"small"})," Export PDF"]})]}),(0,P.jsxs)("div",{className:"refresh-actions",children:[(0,P.jsx)("button",{className:"btn btn-outline btn-sm",onClick:()=>w(t.id),disabled:x,children:"\ud83d\udd04 Refresh"}),(0,P.jsx)("button",{className:"btn btn-outline",onClick:()=>i(null),children:"\u2190 Back to Tests"})]})]})]}),(0,P.jsx)("div",{className:"results-summary",children:(0,P.jsxs)("div",{className:"summary-stats",children:[(0,P.jsxs)("span",{className:"stat-item",children:[(0,P.jsx)("strong",{children:"Total Submissions:"})," ",l.length]}),(0,P.jsxs)("span",{className:"stat-item",children:[(0,P.jsx)("strong",{children:"Evaluated:"})," ",l.filter(e=>"evaluated"===e.status).length]}),(0,P.jsxs)("span",{className:"stat-item",children:[(0,P.jsx)("strong",{children:"Pending:"})," ",l.filter(e=>"evaluated"!==e.status).length]}),(0,P.jsxs)("span",{className:"stat-item",children:[(0,P.jsx)("strong",{children:"Test Total:"})," ",t.totalMarks||100," marks"]})]})}),v&&(0,P.jsx)("div",{className:"alert alert-error",children:v}),x?(0,P.jsx)("div",{className:"loading-results",children:(0,P.jsx)(c.A,{message:"Loading detailed submissions",subtext:"Processing candidate answers and calculating scores",variant:"inline",size:"large"})}):0===l.length?(0,P.jsx)("div",{className:"no-submissions",children:"No submissions for this test yet."}):(0,P.jsx)("div",{className:"submissions-grid",children:l.map(e=>{var s,a,i,n,c,r;const x=e.candidateName||e.displayName||"Unknown Candidate";return(0,P.jsxs)("div",{className:"submission-card",children:[(0,P.jsxs)("div",{className:"submission-info",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("h4",{children:"Candidate Submission"}),(0,P.jsx)("div",{className:"candidate-name",children:x}),(0,P.jsxs)("div",{className:"candidate-id",children:["ID: ",e.candidateId||"N/A"]}),(0,P.jsxs)("div",{className:"submission-date",children:["Submitted: ",(null===(s=e.submittedAt)||void 0===s||null===(a=s.toDate)||void 0===a||null===(i=a.call(s))||void 0===i?void 0:i.toLocaleString())||"Not submitted"]}),(0,P.jsxs)("div",{className:"submission-duration",children:["Duration: ",e.timeTaken?"".concat(Math.round(e.timeTaken/60)," minutes"):"N/A"]}),e.evaluatedAt&&(0,P.jsxs)("div",{className:"evaluation-date",children:["Evaluated: ",null===(n=e.evaluatedAt)||void 0===n||null===(c=n.toDate)||void 0===c||null===(r=c.call(n))||void 0===r?void 0:r.toLocaleString()]})]}),(0,P.jsx)("span",{className:"badge ".concat("evaluated"===e.status?"badge-success":"badge-neutral"),children:e.status||"submitted"})]}),(0,P.jsxs)("div",{className:"score-input",children:[(0,P.jsx)("label",{children:"Score:"}),(0,P.jsx)("input",{type:"number",min:"0",max:t.totalMarks||100,step:"0.5",value:void 0!==e.totalMarksAwarded?e.totalMarksAwarded:e.score||0,onChange:s=>{const a=parseFloat(s.target.value)||0;(async(e,a)=>{try{const s=(0,u.doc)(h.db,"results",e);await(0,u.updateDoc)(s,{totalMarksAwarded:a,score:Math.round(a/(t.totalMarks||100)*100),status:"evaluated",evaluatedAt:(0,u.serverTimestamp)(),evaluatedBy:"head"}),o(l.map(s=>s.id===e?(0,d.A)((0,d.A)({},s),{},{totalMarksAwarded:a,score:Math.round(a/(t.totalMarks||100)*100),status:"evaluated"}):s))}catch(s){console.error("Error updating submission score:",s),g("Failed to update score")}})(e.id,a)}}),(0,P.jsxs)("span",{children:["/",t.totalMarks||100," marks"]}),void 0!==e.totalMarksAwarded&&(0,P.jsxs)("div",{className:"percentage-display",children:["(",Math.round(e.totalMarksAwarded/(t.totalMarks||100)*100),"%)"]}),(0,P.jsxs)("div",{className:"submission-stats",children:[(0,P.jsxs)("div",{className:"questions-attempted",children:["Questions: ",e.answers?Object.keys(e.answers).length:0," answered"]}),e.evaluatedBy&&(0,P.jsxs)("div",{className:"evaluated-by",children:["Evaluated by: ",e.evaluatedBy]})]}),(0,P.jsxs)("button",{className:"btn btn-sm btn-outline",onClick:()=>m(e),title:"View Details",children:[(0,P.jsx)(O,{name:"computer",size:"small"})," View Details"]})]})]},e.id)})})]}):(0,P.jsxs)("div",{className:"head-results",children:[(0,P.jsxs)("div",{className:"results-header",children:[(0,P.jsx)("h3",{children:"Test Results"}),(0,P.jsxs)("div",{className:"branch-badge",children:[(0,P.jsx)("span",{children:"Branch:"}),(0,P.jsx)("span",{className:"badge badge-primary",children:(null===f||void 0===f?void 0:f.branch)||"Full Stack"})]})]}),v&&(0,P.jsx)("div",{className:"alert alert-error",children:v}),x?(0,P.jsx)("div",{className:"loading-results",children:(0,P.jsx)(c.A,{message:"Loading test results",subtext:"Gathering candidate submissions and performance data",variant:"inline",size:"large"})}):0===e.length?(0,P.jsx)("div",{className:"no-tests",children:"No tests created yet."}):(0,P.jsx)("div",{className:"tests-grid",children:e.map(e=>(0,P.jsx)("div",{className:"test-card clickable",onClick:()=>{i(e),w(e.id)},children:(0,P.jsxs)("div",{className:"test-info",children:[(0,P.jsxs)("div",{children:[(0,P.jsx)("h4",{children:e.title}),(0,P.jsxs)("div",{className:"test-meta",children:[e.branch," \u2022 ",e.duration," \u2022 ",e.totalMarks," marks"]}),e.description&&(0,P.jsx)("div",{className:"test-description",children:e.description})]}),(0,P.jsx)("button",{className:"btn btn-sm",children:"View"})]})},e.id))})]})}function le(e){let{submission:s,test:t,onBack:i}=e;const[n,l]=(0,a.useState)([]),[o,r]=(0,a.useState)(!0),[m,p]=(0,a.useState)({}),[v,g]=(0,a.useState)(0),[b,j]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{try{const e=(0,u.collection)(h.db,"tests",t.id,"questions"),a=(await(0,u.getDocs)(e)).docs.map(e=>{const s=e.data();return(0,d.A)({id:s.questionId||e.id,questionText:s.questionText,questionType:s.questionType,options:s.options||[],correctAnswer:s.correctAnswer,marks:s.marks||1,imageUrl:s.imageUrl||""},s)});a.sort((e,s)=>(parseInt(e.id)||0)-(parseInt(s.id)||0));const i=a.map(e=>{var t;const a=(null===(t=s.answers)||void 0===t?void 0:t[e.id])||"";return(0,d.A)((0,d.A)({},e),{},{candidateAnswer:a,isCorrect:"mcq"===e.questionType?a===e.correctAnswer:null})}),n={};let o=0;i.forEach(e=>{var t;const a=null===(t=s.questionMarks)||void 0===t?void 0:t[e.id];void 0!==a?(n[e.id]=a,o+=a):n[e.id]=0}),l(i),p(n),g(o),r(!1)}catch(e){console.error("Error loading submission details:",e),r(!1)}})()},[s,t.id]);return o?(0,P.jsx)("div",{className:"loading-tests",children:(0,P.jsx)(c.A,{message:"Loading submission details",subtext:"Fetching candidate answers and question data",variant:"inline",size:"large"})}):(0,P.jsxs)("div",{className:"submission-detail-view",children:[(0,P.jsxs)("div",{className:"submission-header",children:[(0,P.jsxs)("button",{className:"btn btn-outline",onClick:i,children:[(0,P.jsx)(O,{name:"submissions",size:"small"})," Back to Submissions"]}),(0,P.jsxs)("div",{className:"submission-info",children:[(0,P.jsx)("h2",{children:"Submission Details"}),(0,P.jsxs)("div",{className:"submission-meta",children:[(0,P.jsxs)("div",{className:"meta-item",children:[(0,P.jsx)("strong",{children:"Candidate:"})," ",s.candidateName||"Unknown"]}),(0,P.jsxs)("div",{className:"meta-item",children:[(0,P.jsx)("strong",{children:"Test:"})," ",t.title]}),(0,P.jsxs)("div",{className:"meta-item",children:[(0,P.jsx)("strong",{children:"Submitted:"})," ",x(s.submittedAt)]}),(0,P.jsxs)("div",{className:"meta-item",children:[(0,P.jsx)("strong",{children:"Score:"})," ",void 0!==s.totalMarksAwarded?"".concat(s.totalMarksAwarded,"/").concat(s.maxPossibleMarks||"N/A"," marks"):void 0!==s.score?"".concat(s.score,"%"):"Not graded"]}),(0,P.jsxs)("div",{className:"meta-item",children:[(0,P.jsx)("strong",{children:"Status:"}),(0,P.jsx)("span",{className:"badge ".concat("evaluated"===s.status?"badge-success":"badge-warning"),children:s.status||"submitted"})]})]})]}),(0,P.jsxs)("div",{className:"marks-summary-header",children:[(0,P.jsxs)("div",{className:"marks-total-display",children:[(0,P.jsx)("span",{className:"marks-total-label",children:"Total Marks:"}),(0,P.jsxs)("span",{className:"marks-total-value",children:[v," / ",n.reduce((e,s)=>e+(s.marks||1),0)]}),(0,P.jsxs)("span",{className:"marks-percentage",children:["(",n.reduce((e,s)=>e+(s.marks||1),0)>0?Math.round(v/n.reduce((e,s)=>e+(s.marks||1),0)*100):0,"%)"]})]}),(0,P.jsx)("div",{className:"marks-actions",children:(0,P.jsx)("button",{className:"btn btn-primary ".concat(b?"btn-loading":""),onClick:async()=>{j(!0);try{const e=n.reduce((e,s)=>e+(s.marks||1),0),t=e>0?Math.round(v/e*100):0,a=(0,u.doc)(h.db,"results",s.id);await(0,u.updateDoc)(a,{questionMarks:m,totalMarksAwarded:v,maxPossibleMarks:e,score:t,status:"evaluated",evaluatedAt:(0,u.serverTimestamp)(),evaluatedBy:"head"}),alert("Marks saved successfully!")}catch(e){console.error("Error saving marks:",e),alert("Failed to save marks. Please try again.")}finally{j(!1)}},disabled:b,children:b?"Saving...":(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(O,{name:"shield",size:"small"})," Save All Marks"]})})})]})]}),(0,P.jsx)("div",{className:"submission-questions",children:n.map((e,s)=>{var t;return(0,P.jsxs)("div",{className:"submission-question-card",children:[(0,P.jsxs)("div",{className:"question-header",children:[(0,P.jsxs)("div",{className:"question-title-section",children:[(0,P.jsxs)("span",{className:"question-number",children:["Q",s+1]}),(0,P.jsxs)("div",{className:"question-meta",children:[(0,P.jsx)("span",{className:"question-type",children:(null===(t=e.questionType)||void 0===t?void 0:t.toUpperCase())||"MCQ"}),(0,P.jsxs)("span",{className:"question-marks",children:["Max: ",e.marks||1," marks"]}),"mcq"===e.questionType&&(0,P.jsxs)("div",{className:"mcq-answer-preview",children:[(0,P.jsxs)("span",{className:"candidate-choice",children:["Choice: ",e.candidateAnswer||"None"]}),(0,P.jsx)("span",{className:"answer-status ".concat(e.isCorrect?"correct":"incorrect"),children:e.isCorrect?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(O,{name:"success",size:"small"})," Correct"]}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(O,{name:"fire",size:"small"})," Incorrect"]})})]})]})]}),(0,P.jsx)("div",{className:"marks-input-section",children:(0,P.jsxs)("div",{className:"marks-input-container",children:[(0,P.jsx)("label",{className:"marks-label",children:"Marks Awarded:"}),(0,P.jsxs)("div",{className:"marks-input-wrapper",children:[(0,P.jsx)("input",{type:"number",min:"0",max:e.marks||1,step:"0.5",value:m[e.id]||0,onChange:s=>((e,s)=>{var t;const a=Math.max(0,parseFloat(s)||0),i=(null===(t=n.find(s=>s.id===e))||void 0===t?void 0:t.marks)||1,l=Math.min(a,i);p(s=>(0,d.A)((0,d.A)({},s),{},{[e]:l}));const o=Object.values((0,d.A)((0,d.A)({},m),{},{[e]:l})).reduce((e,s)=>e+(s||0),0);g(o)})(e.id,s.target.value),className:"marks-input"}),(0,P.jsxs)("span",{className:"marks-max",children:["/ ",e.marks||1]})]}),"mcq"===e.questionType&&null!==e.isCorrect&&(0,P.jsx)("span",{className:"mcq-result-indicator ".concat(e.isCorrect?"correct":"incorrect"),children:e.isCorrect?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(O,{name:"success",size:"small"})," Correct Answer"]}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(O,{name:"fire",size:"small"})," Wrong Answer"]})})]})})]}),(0,P.jsxs)("div",{className:"question-content",children:[(0,P.jsx)("div",{className:"question-text",children:e.questionText||"No question text"}),e.imageUrl&&(0,P.jsx)("div",{className:"question-image",children:(0,P.jsx)("img",{src:e.imageUrl,alt:"Question illustration",style:{maxWidth:"100%",maxHeight:"300px",borderRadius:"8px",border:"1px solid #e5e7eb",marginTop:"1rem"},onError:e=>{e.target.style.display="none"}})}),"mcq"===e.questionType&&(0,P.jsxs)("div",{className:"mcq-section",children:[(0,P.jsxs)("div",{className:"candidate-answer-display",children:[(0,P.jsx)("h4",{children:"Candidate's Answer:"}),(0,P.jsxs)("div",{className:"candidate-selected-answer ".concat(e.isCorrect?"correct":"incorrect"),children:[(0,P.jsx)("span",{className:"selected-option-text",children:e.candidateAnswer||"No answer selected"}),(0,P.jsx)("span",{className:"answer-result ".concat(e.isCorrect?"correct":"incorrect"),children:e.isCorrect?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(O,{name:"success",size:"small"})," Correct"]}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(O,{name:"fire",size:"small"})," Incorrect"]})})]})]}),(0,P.jsxs)("div",{className:"question-options",children:[(0,P.jsx)("h4",{children:"All Options:"}),e.options.map((s,t)=>(0,P.jsxs)("div",{className:"option ".concat(s===e.correctAnswer?"correct-option":""," ").concat(s===e.candidateAnswer?"selected-option":""),children:[(0,P.jsxs)("span",{className:"option-label",children:[String.fromCharCode(65+t),"."]}),(0,P.jsx)("span",{className:"option-text",children:s}),s===e.correctAnswer&&(0,P.jsxs)("span",{className:"correct-indicator",children:[(0,P.jsx)(O,{name:"success",size:"small"})," Correct Answer"]}),s===e.candidateAnswer&&s!==e.correctAnswer&&(0,P.jsx)("span",{className:"selected-indicator",children:"\u2190 Candidate Selected"}),s===e.candidateAnswer&&s===e.correctAnswer&&(0,P.jsx)("span",{className:"both-indicator",children:"\u2190 Candidate Selected (Correct!)"})]},t))]})]}),("long"===e.questionType||"code"===e.questionType)&&(0,P.jsxs)("div",{className:"text-answer-section",children:[(0,P.jsx)("h4",{children:"Candidate's Answer:"}),(0,P.jsx)("div",{className:"candidate-answer",children:e.candidateAnswer?(0,P.jsx)("pre",{style:{background:"#f8f9fa",padding:"1rem",borderRadius:"8px",border:"1px solid #e5e7eb",whiteSpace:"pre-wrap",fontFamily:"code"===e.questionType?"monospace":"inherit"},children:e.candidateAnswer}):(0,P.jsx)("div",{className:"no-answer",children:"No answer provided"})})]})]})]},e.id)})}),0===n.length&&(0,P.jsx)("div",{className:"no-questions",children:(0,P.jsx)("p",{children:"No questions found for this submission"})})]})}const oe=function(){const e=(0,i.Zp)(),[s,t]=(0,a.useState)("create"),{loading:l}=(0,n.D)(),o=(0,a.useMemo)(()=>[{label:"Create Test",value:"create"},{label:"Manage Tests",value:"manage"},{label:"Results",value:"results"},{label:"Leaderboard",value:"leaderboard"}],[]);return l?(0,P.jsx)(c.A,{message:"Loading head dashboard",subtext:"Please wait while we prepare your workspace"}):(0,P.jsxs)("div",{className:"head-dashboard theme-head",children:[(0,P.jsx)("div",{className:"dashboard-header",children:(0,P.jsxs)("div",{className:"header-content",children:[(0,P.jsxs)("div",{className:"user-info",children:[(0,P.jsx)("h1",{children:"Head Dashboard"}),(0,P.jsx)("span",{className:"badge badge-head",children:"Head"})]}),(0,P.jsx)("button",{className:"btn btn-outline",onClick:async()=>{try{await(0,r.CI)(h.j2),e("/")}catch(s){console.error("Sign out error:",s)}},children:"Sign Out"})]})}),(0,P.jsxs)("div",{className:"dashboard-content",children:[(0,P.jsx)("div",{className:"dashboard-nav",children:(0,P.jsx)("div",{className:"tc-tabs",children:o.map(e=>(0,P.jsx)("button",{className:"tc-tab ".concat(s===e.value?"is-active":""),onClick:()=>t(e.value),"data-tab":e.value,children:e.label},e.value))})}),(0,P.jsxs)("div",{className:"dashboard-main",children:["create"===s&&(0,P.jsx)(ae,{}),"manage"===s&&(0,P.jsx)(ie,{}),"results"===s&&(0,P.jsx)(ne,{}),"leaderboard"===s&&(0,P.jsx)(Q,{})]})]})]})};var ce=t(9414);function de(){const e=(0,i.Zp)(),{user:s}=(0,n.D)(),[t,l]=(0,a.useState)([]),[o,r]=(0,a.useState)(!1),[m,x]=(0,a.useState)(""),[v,g]=(0,a.useState)(""),[b,j]=(0,a.useState)(!1),[N,f]=(0,a.useState)(""),[y,w]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{r(!0),x("");try{const e=(0,u.collection)(h.db,"tests"),s=await(0,u.getDocs)(e),t=new Date,a=s.docs.map(e=>(0,d.A)({id:e.id},e.data())).filter(e=>{var s,a;const i=!e.status||"active"===e.status,n=!e.endDate||(null===(s=e.endDate)||void 0===s?void 0:s.toDate)&&e.endDate.toDate()>t||(null===(a=e.endDate)||void 0===a?void 0:a.seconds)&&new Date(1e3*e.endDate.seconds)>t;return i&&n}),i=new Map;a.forEach(e=>{const s="".concat(e.title,"_").concat(e.branch),t=i.get(s);if(t){var a,n,l,o,c,d;const v=null!==(a=t.endDate)&&void 0!==a&&null!==(n=a.toDate)&&void 0!==n&&n.call(a)||null!==(l=t.endDate)&&void 0!==l&&l.seconds?new Date(1e3*t.endDate.seconds):null,g=null!==(o=e.endDate)&&void 0!==o&&null!==(c=o.toDate)&&void 0!==c&&c.call(o)||null!==(d=e.endDate)&&void 0!==d&&d.seconds?new Date(1e3*e.endDate.seconds):null;if(v&&g)g>v&&i.set(s,e);else{var r,u,m,h,x,p;const a=(null===(r=t.createdAt)||void 0===r||null===(u=r.toDate)||void 0===u||null===(m=u.call(r))||void 0===m?void 0:m.getTime())||0;((null===(h=e.createdAt)||void 0===h||null===(x=h.toDate)||void 0===x||null===(p=x.call(h))||void 0===p?void 0:p.getTime())||0)>a&&i.set(s,e)}}else i.set(s,e)});const n=Array.from(i.values());l(n)}catch(e){console.log("[Candidate:loadTests:error]",e.code,e.message),x(e.message||"Failed to load tests")}finally{r(!1)}})()},[]);const k=t.filter(e=>{var s,t,a;const i=v.toLowerCase();return(null===(s=e.title)||void 0===s?void 0:s.toLowerCase().includes(i))||(null===(t=e.branch)||void 0===t?void 0:t.toLowerCase().includes(i))||(null===(a=e.description)||void 0===a?void 0:a.toLowerCase().includes(i))});return o?(0,P.jsx)("div",{className:"loading-tests",children:(0,P.jsx)(c.A,{message:"Loading tests",subtext:"Fetching available tests for you",variant:"inline",size:"large"})}):m?(0,P.jsxs)("div",{className:"error",children:["Error: ",m]}):(0,P.jsxs)("div",{className:"candidate-tests",children:[b&&(0,P.jsx)(ce.A,{message:N,onClose:()=>j(!1)}),(0,P.jsx)("div",{className:"search-container",children:(0,P.jsx)("input",{type:"text",placeholder:"Search tests...",value:v,onChange:e=>g(e.target.value),className:"search-input"})}),(0,P.jsx)("div",{className:"tests-grid",children:k.map(t=>(0,P.jsxs)("div",{className:"test-card",children:[(0,P.jsxs)("div",{className:"test-header",children:[(0,P.jsx)("h3",{className:"test-title",children:t.title}),(0,P.jsx)("span",{className:"badge badge-neutral",children:t.branch})]}),(0,P.jsx)("p",{className:"test-description",children:t.description||"No description available"}),(0,P.jsxs)("div",{className:"test-meta",children:[(0,P.jsxs)("div",{className:"meta-item",children:[(0,P.jsx)("span",{className:"meta-icon",children:"\u23f1\ufe0f"}),(0,P.jsxs)("span",{children:["Duration: ",t.duration||"60 minutes"]})]}),(0,P.jsxs)("div",{className:"meta-item",children:[(0,P.jsx)("span",{className:"meta-icon",children:"\ud83d\udcdd"}),(0,P.jsxs)("span",{children:["Total Marks: ",t.totalMarks||"N/A"]})]}),(0,P.jsxs)("div",{className:"meta-item",children:[(0,P.jsx)("span",{className:"meta-icon",children:"\ud83d\udcc5"}),(0,P.jsxs)("span",{children:["Created: ",p(t.createdAt)]})]})]}),(0,P.jsxs)("div",{className:"test-actions",children:[(0,P.jsxs)("button",{className:"btn btn-primary test-start-btn",onClick:()=>(async t=>{if(s){w(!0);try{const a=(0,u.query)((0,u.collection)(h.db,"results"),(0,u.where)("candidateId","==",s.uid),(0,u.where)("testId","==",t.id)),i=(await(0,u.getDocs)(a)).size;console.log("UserDashboard submission check:",{submissionCount:i,allowMultiple:t.allowMultipleSubmissions,testId:t.id,shouldBlock:i>=3&&t.allowMultipleSubmissions,attemptNumber:i+1}),0===i?(console.log("First attempt - proceeding to test"),e("/test/".concat(t.id))):i>0&&!t.allowMultipleSubmissions?(console.log("Multiple submissions not allowed - showing blocked card"),f("This test does not allow multiple submissions. You have already submitted this test ".concat(i," time").concat(i>1?"s":"",". Please contact your branch head if you need to retake this test.")),j(!0)):i>0&&t.allowMultipleSubmissions&&(i>=3?(console.log("Maximum attempts reached - showing blocked card"),f("You have reached the maximum number of attempts (3) for this test. You have already submitted this test ".concat(i," times. Please contact your branch head if you need additional attempts.")),j(!0)):(console.log("Attempt ".concat(i+1,"/3 - proceeding to test")),e("/test/".concat(t.id))))}catch(m){console.error("Error checking submission status:",m),e("/test/".concat(t.id))}finally{w(!1)}}})(t),disabled:y,children:[(0,P.jsx)("span",{className:"btn-icon",children:y?"\u23f3":"\ud83d\ude80"}),y?"Checking...":"Start Test"]}),t.password&&(0,P.jsxs)("div",{className:"test-password-hint",children:[(0,P.jsx)("span",{className:"password-icon",children:"\ud83d\udd12"}),(0,P.jsx)("span",{children:"Password required"})]})]})]},t.id))}),0===k.length&&(0,P.jsx)("div",{className:"no-tests",children:v?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{className:"no-tests-icon",children:"\ud83d\udd0d"}),(0,P.jsx)("h3",{children:"No Tests Found"}),(0,P.jsxs)("p",{children:['No tests match your search "',v,'"']}),(0,P.jsx)("button",{className:"btn btn-outline",onClick:()=>g(""),children:"Clear Search"})]}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)("div",{className:"no-tests-icon",children:"\ud83d\udcda"}),(0,P.jsx)("h3",{children:"No Tests Available"}),(0,P.jsx)("p",{children:"There are no active tests at the moment. Check back later!"}),(0,P.jsx)("button",{className:"btn btn-primary",onClick:()=>window.location.reload(),children:"Refresh Tests"})]})})]})}function re(){const[e,s]=(0,a.useState)([]),[t,i]=(0,a.useState)([]),[l,o]=(0,a.useState)(""),[r,m]=(0,a.useState)(!1),[x,v]=(0,a.useState)(""),{user:g,userDoc:b}=(0,n.D)();return(0,a.useEffect)(()=>{if(l.trim()){const s=l.toLowerCase(),t=e.filter(e=>(e.testTitle||e.title||"").toLowerCase().includes(s));i(t)}else i(e)},[l,e]),(0,a.useEffect)(()=>{(async()=>{if(null!==g&&void 0!==g&&g.uid){m(!0),v("");try{const e=(0,u.collection)(h.db,"results"),t=(0,u.query)(e,(0,u.where)("candidateId","==",g.uid),(0,u.where)("status","in",["submitted","evaluated"])),a=await(0,u.getDocs)(t),n=await Promise.all(a.docs.map(async e=>{const s=(0,d.A)({id:e.id},e.data());try{const e=await(0,u.getDoc)((0,u.doc)(h.db,"tests",s.testId));if(e.exists()){const a=e.data();var t;if(s.testTitle=a.title,void 0===s.totalMarks)(null===(t=a.questions)||void 0===t?void 0:t.length)>0?s.totalMarks=a.questions.reduce((e,s)=>e+(s.marks||1),0):a.totalMarks&&(s.totalMarks=a.totalMarks)}}catch(x){console.error("Error fetching test data:",x)}return s}));n.sort((e,s)=>{var t,a,i,n;const l=null!==(t=e.submittedAt)&&void 0!==t&&null!==(a=t.toDate)&&void 0!==a&&a.call(t)?e.submittedAt.toDate().getTime():0;return(null!==(i=s.submittedAt)&&void 0!==i&&null!==(n=i.toDate)&&void 0!==n&&n.call(i)?s.submittedAt.toDate().getTime():0)-l});const l=[],o=new Set;for(const s of n)o.has(s.testId)||(o.add(s.testId),l.push(s));s(l),i(l)}catch(e){console.log("[Candidate:loadResults:error]",e.code,e.message),v(e.message||"Failed to load results")}finally{m(!1)}}})()},[null===g||void 0===g?void 0:g.uid]),r?(0,P.jsx)("div",{className:"loading-results",children:(0,P.jsx)(c.A,{message:"Loading your results",subtext:"Analyzing your test performance and scores",variant:"inline",size:"large"})}):x?(0,P.jsxs)("div",{className:"error",children:["Error: ",x]}):(0,P.jsxs)("div",{className:"candidate-results",children:[(0,P.jsxs)("div",{className:"results-header",children:[(0,P.jsx)("h2",{children:"Your Test Results"}),(0,P.jsx)("div",{className:"search-container",children:(0,P.jsx)("input",{type:"text",placeholder:"Search by test title...",value:l,onChange:e=>o(e.target.value),className:"search-input"})})]}),0===t.length?(0,P.jsxs)("div",{className:"no-results",children:[(0,P.jsx)("div",{className:"no-results-icon",children:"\ud83d\udcca"}),(0,P.jsx)("h3",{children:"No Test Results Yet"}),(0,P.jsx)("p",{children:"Complete some tests to see your results here."}),(0,P.jsx)("button",{className:"btn btn-primary",onClick:()=>window.location.reload(),children:"Refresh Results"})]}):(0,P.jsx)("div",{className:"results-grid",children:t.map(e=>(0,P.jsxs)("div",{className:"result-card ".concat("auto-submitted"===e.status?"auto-submitted":""),children:[(0,P.jsx)("h3",{className:"result-title",children:e.testTitle||e.title||"Test"}),(0,P.jsx)("div",{className:"candidate-info",children:(0,P.jsxs)("span",{className:"candidate-name",children:["Candidate: ",(null===b||void 0===b?void 0:b.name)||(null===g||void 0===g?void 0:g.displayName)||"Unknown"]})}),(0,P.jsxs)("div",{className:"result-score-container",children:[(0,P.jsx)("div",{className:"score-display",children:(0,P.jsxs)("span",{className:"score-value",children:[void 0!==e.totalMarksAwarded&&null!==e.totalMarksAwarded?e.totalMarksAwarded:void 0!==e.score&&void 0!==e.totalMarks?Math.round(e.score/100*e.totalMarks):"--",(0,P.jsx)("span",{className:"score-divider",children:"/"}),(0,P.jsx)("span",{className:"score-total",children:void 0!==e.totalMarks?e.totalMarks:"--"})]})}),(0,P.jsx)("div",{className:"score-label",children:"evaluated"===e.status?"Score":"auto-submitted"===e.status?"Auto-Submitted":"Submitted"})]}),e.submittedAt&&(0,P.jsx)("div",{className:"submission-info",children:(0,P.jsxs)("span",{className:"submission-date",children:["Submitted: ",p(e.submittedAt)]})})]},e.id))})]})}const ue=function(){const e=(0,i.Zp)(),[s,t]=(0,a.useState)("tests"),{user:l,userDoc:o,loading:d}=(0,n.D)(),[u,m]=(0,a.useState)(!1);(0,a.useEffect)(()=>{t("tests")},[]);const x=(0,a.useMemo)(()=>[{label:"Available Tests",value:"tests"},{label:"My Results",value:"results"},{label:"Leaderboard",value:"leaderboard"}],[]);return d?(0,P.jsx)(c.A,{message:"Loading dashboard",subtext:"Please wait while we prepare your workspace"}):(0,P.jsxs)("div",{className:"user-dashboard ".concat("theme-candidate"),children:[(0,P.jsx)("div",{className:"dashboard-header",children:(0,P.jsxs)("div",{className:"header-content",children:[(0,P.jsx)("div",{className:"user-info",children:(0,P.jsxs)("h1",{children:["Welcome, ",(null===o||void 0===o?void 0:o.name)||(null===l||void 0===l?void 0:l.displayName)||"Candidate"]})}),(0,P.jsxs)("div",{className:"header-actions",style:{display:"flex",alignItems:"center",gap:"8px",position:"relative"},children:[(0,P.jsxs)("button",{className:"btn btn-outline",onClick:()=>m(e=>!e),title:"Open Profile Menu",children:[(0,P.jsx)(O,{name:"user",size:"small"})," Profile"]}),u&&(0,P.jsxs)("div",{className:"profile-menu",style:{position:"absolute",right:0,top:"110%",background:"#fff",border:"1px solid #e5e7eb",borderRadius:8,padding:8,minWidth:180,boxShadow:"0 10px 25px rgba(0,0,0,0.08)",zIndex:15},children:[(0,P.jsx)("button",{className:"btn btn-ghost",style:{width:"100%",textAlign:"left",padding:"8px 10px"},onClick:()=>{m(!1),e("/account")},children:"Account"}),(0,P.jsx)("button",{className:"btn btn-ghost",style:{width:"100%",textAlign:"left",padding:"8px 10px"},onClick:async()=>{try{await(0,r.CI)(h.j2),e("/")}catch(s){console.error("Sign out error:",s)}},children:"Sign Out"})]})]})]})}),(0,P.jsxs)("div",{className:"dashboard-content",children:[(0,P.jsx)("div",{className:"dashboard-nav",children:(0,P.jsx)("div",{className:"tc-tabs",children:x.map(e=>(0,P.jsx)("button",{className:"tc-tab ".concat(s===e.value?"is-active":""),onClick:()=>t(e.value),"data-tab":e.value,children:e.label},e.value))})}),(0,P.jsxs)("div",{className:"dashboard-main",children:["tests"===s&&(0,P.jsx)(de,{}),"results"===s&&(0,P.jsx)(re,{}),"leaderboard"===s&&(0,P.jsx)(Q,{})]})]})]})};const me=function(){const e=(0,i.Zp)(),s=(0,i.zy)(),{user:t,userDoc:d,blocked:r,loading:u}=(0,n.D)(),m=((null===d||void 0===d?void 0:d.role)||"candidate").toLowerCase();return(0,a.useEffect)(()=>{const e=new URLSearchParams(s.search);if("true"===e.get("verified")){"candidate"===e.get("role")?(0,l.Te)("\ud83c\udf89 Welcome to Testify! Your email has been verified successfully. You can now start taking tests as a candidate."):(0,l.Te)("\ud83c\udf89 Welcome to Testify! Your email has been verified successfully. You can now access all features."),window.history.replaceState({},document.title,s.pathname)}},[s]),(0,a.useEffect)(()=>{u||t||e("/login")},[u,t,e]),u?(0,P.jsx)(c.A,{message:"Loading dashboard",subtext:"Please wait while we prepare your workspace"}):t?r?(0,P.jsx)(o.default,{}):"admin"===m?(0,P.jsx)(ee,{}):"head"===m?(0,P.jsx)(oe,{}):(0,P.jsx)(ue,{}):(0,P.jsx)(c.A,{message:"Redirecting to login"})}},7951:()=>{},8884:(e,s,t)=>{t.r(s),t.d(s,{default:()=>o});var a=t(5982),i=(t(5043),t(5352)),n=t(791),l=t(579);const o=function(){const e=(0,i.Zp)();return(0,l.jsx)("div",{className:"blocked-page",children:(0,l.jsxs)("div",{className:"blocked-container",children:[(0,l.jsx)("div",{className:"blocked-icon",children:(0,l.jsxs)("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,l.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"#ef4444",strokeWidth:"2"}),(0,l.jsx)("path",{d:"M4.93 4.93l14.14 14.14",stroke:"#ef4444",strokeWidth:"2"}),(0,l.jsx)("circle",{cx:"12",cy:"12",r:"6",fill:"#fef2f2"})]})}),(0,l.jsxs)("div",{className:"blocked-content",children:[(0,l.jsx)("h1",{children:"Account Blocked"}),(0,l.jsx)("p",{className:"blocked-message",children:"Your account has been temporarily blocked by the administrator."}),(0,l.jsx)("p",{className:"blocked-submessage",children:"This may be due to a violation of our terms of service or suspicious activity."}),(0,l.jsxs)("div",{className:"blocked-info",children:[(0,l.jsxs)("div",{className:"info-item",children:[(0,l.jsx)("strong",{children:"What can you do?"}),(0,l.jsxs)("ul",{children:[(0,l.jsx)("li",{children:"Contact the administrator for more information"}),(0,l.jsx)("li",{children:"Review our terms of service"}),(0,l.jsx)("li",{children:"Wait for the block to be lifted"})]})]}),(0,l.jsxs)("div",{className:"info-item",children:[(0,l.jsx)("strong",{children:"Need help?"}),(0,l.jsx)("p",{children:"If you believe this is a mistake, please contact support:"}),(0,l.jsx)("div",{className:"contact-info",children:(0,l.jsx)("span",{children:"\ud83d\udce7 coderscafe@jeckukas.org.in"})})]})]})]}),(0,l.jsxs)("div",{className:"blocked-actions",children:[(0,l.jsx)("button",{className:"btn btn-primary",onClick:async()=>{try{await(0,a.CI)(n.j2),e("/login")}catch(s){console.error("Error signing out:",s)}},children:"Sign Out"}),(0,l.jsx)("button",{className:"btn btn-outline",onClick:()=>window.location.reload(),children:"Refresh Status"})]}),(0,l.jsx)("div",{className:"blocked-footer",children:(0,l.jsx)("p",{children:"\xa9 2024 Testify. All rights reserved."})})]})})}},9414:(e,s,t)=>{t.d(s,{A:()=>i});var a=t(579);const i=function(e){let{message:s,onClose:t}=e;return(0,a.jsx)("div",{className:"blocked-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:(0,a.jsxs)("div",{className:"blocked-card",style:{backgroundColor:"white",borderRadius:"12px",padding:"32px",maxWidth:"500px",margin:"20px",textAlign:"center",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.15)",border:"2px solid #ef4444"},children:[(0,a.jsx)("div",{style:{fontSize:"64px",color:"#ef4444",marginBottom:"16px"},children:"\ud83d\udeab"}),(0,a.jsx)("h2",{style:{color:"#ef4444",marginBottom:"16px",fontSize:"24px",fontWeight:"bold"},children:"Multiple Submissions Not Allowed"}),(0,a.jsx)("p",{style:{color:"#6b7280",marginBottom:"24px",lineHeight:"1.6",fontSize:"16px"},children:s||"This test does not allow multiple submissions. You have already submitted this test. Please contact your domain head if you need to retake this test."}),(0,a.jsxs)("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",padding:"12px",marginBottom:"24px"},children:[(0,a.jsx)("div",{style:{fontSize:"14px",color:"#dc2626",fontWeight:"500"},children:"\ud83d\udccb Contact Information"}),(0,a.jsx)("div",{style:{fontSize:"14px",color:"#7f1d1d",marginTop:"4px"},children:"Please reach out to your domain head or administrator for assistance with test retakes or additional attempts."})]}),(0,a.jsx)("div",{style:{display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap"},children:t&&(0,a.jsx)("button",{onClick:t,className:"btn btn-outline",style:{backgroundColor:"transparent",color:"#6b7280",padding:"12px 24px",border:"1px solid #d1d5db",borderRadius:"8px",cursor:"pointer",fontSize:"16px",fontWeight:"500"},children:"Close"})})]})})}},9530:(e,s,t)=>{t.d(s,{A:()=>i});t(5043),t(7951);var a=t(579);const i=function(e){let{message:s="Loading",subtext:t="Please wait...",size:i="normal",variant:n="dashboard"}=e;return"inline"===n?(0,a.jsxs)("div",{className:"inline-loading ".concat(i),children:[(0,a.jsxs)("div",{className:"inline-spinner",children:[(0,a.jsx)("div",{className:"spinner-ring"}),(0,a.jsx)("div",{className:"spinner-ring"}),(0,a.jsx)("div",{className:"spinner-ring"})]}),(0,a.jsx)("span",{className:"inline-text",children:s})]}):(0,a.jsx)("div",{className:"dashboard-loading",children:(0,a.jsxs)("div",{className:"loading-content",children:[(0,a.jsx)("div",{className:"loading-logo",children:"TESTIFY"}),(0,a.jsxs)("div",{className:"loading-spinner",children:[(0,a.jsx)("div",{className:"spinner-ring"}),(0,a.jsx)("div",{className:"spinner-ring"}),(0,a.jsx)("div",{className:"spinner-ring"}),(0,a.jsx)("div",{className:"spinner-ring"})]}),(0,a.jsxs)("div",{className:"loading-text",children:[s,(0,a.jsxs)("div",{className:"loading-dots",children:[(0,a.jsx)("div",{className:"loading-dot"}),(0,a.jsx)("div",{className:"loading-dot"}),(0,a.jsx)("div",{className:"loading-dot"})]})]}),(0,a.jsx)("div",{className:"loading-subtext",children:t})]})})}}}]);
//# sourceMappingURL=278.53bf62e5.chunk.js.map